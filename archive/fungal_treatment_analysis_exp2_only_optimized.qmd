---
title: "Fungal Treatment of Faecal Material: Experiment 1_2 Analysis"
author: "Analysis Report"
date: "`r Sys.Date()`"
format: 
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    theme: cosmo
    cache: true
editor: visual
---

# Introduction

Decentralized sanitation is needed in places where sewered toilets cannot be built due to remote locations or where no central treatment plants are available. To meet this critical need, a variety of decentralized sanitation technologies have been developed, each with its own approach to safely managing human waste. A primary challenge for these systems is to effectively treat the excreta to inactivate pathogens, control odors, and manage the final end-product in a sustainable and user-friendly way. These solutions range broadly, from simple pit latrines to more engineered systems that separate different waste streams at the source for distinct treatment. One solution for decentralized sanitation is the Urine Diversion Dry Toilet (UDDT), where faeces and urine are collected in separate chambers. Urine is mostly sterile and can be safely handled (...). The collected faecal material is covered using different additives; commonly used are ash, lime, sawdust, soil, or other lignocellulosic materials to help dry out the material faster and avoid bad odour. The dried faecal mixture relies mostly on desiccation for pathogen inactivation, which requires long storage times for up to 1 year depending on conditions, and rewetting can lead to pathogen reactivation (). Due to desiccation, the collected material will not degrade faecal material in combination with bulking agents leading to accumulation of material, still reminiscent of mixed faecal material rather than finished compost [(Tilley et al., 2014)](https://www.zotero.org/google-docs/?8uSl90). Composting toilets where faecal material is degraded in the collection chamber itself exist. However, in these systems the composting process is hard to control. Material can become too dry for efficient degradation but not dry enough for pathogen inactivation and temperatures to guarantee pathogen inactivation are not reached [(Redlinger et al., 2001)](https://www.zotero.org/google-docs/?S3S9zR).

Degradation of faecal material can result in several deadlock states that significantly slow down or completely halt the degradation process. While drying out is one of them others are, the low C:N ratio of about 8:1. The low C:N ratio can cause high pH \>8 which can lead to toxic ammonia production killing microbes and stopping decomposition and leading to bad odour. Especially at ambient temperature ammonia can be assembled in high concentrations in the substrate.Substrate compression and limited amount of crude fibers leading to dense structure creating anaerobic conditions [(Rose et al., 2015)](https://www.zotero.org/google-docs/?IoOqUg), Slowing down the degradation process. Both C:N ratio and aeration could be corrected by addition of lignocellulose material as bulking agents. However, due to the increased surface and the dried material the water content of the faecal mass can become too low for bacteria which need high water activity to effectively grow [(Ahn et al., 2008; Richard et al., 2002)](https://www.zotero.org/google-docs/?sbpYU7). Furthermore,lignocellulosic materials are recalcitrant against bacterial degradation especially if thermophilic conditions are not reached. Addition of lignocellulose after each defaecation leads to a final substrate mostly consisting of lignocellulose rather than faecal material. The high content of lignocellulose could make the material an ideal substrate for fungal growth. Fungi can have a broad adaptation on water content in the substrate and can efficiently grow at lower aW values and a broad range of pH compared to bacteria. Fungi are known for their strong lignocellulose degrading enzymes that are being used in many industries (...).

Filamentous fungi are an essential part in faecal mass degradation and carbon cycling especially in herbivore dung [(Calaça et al., 2024)](https://www.zotero.org/google-docs/?tzbaqK). A diverse fungal community that grows on dung has been described with certain species entirely dependent on this substrate to reproduce [(Richardson & Watling, 1968)](https://www.zotero.org/google-docs/?2txFvR). Herbivore dung consists of up to 70% of undigested lignocellulosic material and has a nitrogen content of 1.8-3% ([Zhao et al., 2022](https://www.zotero.org/google-docs/?WT7l7t)). Human faeces have a higher Nitrogen content of 5-7% and lower in fibrous material around 25%, but strongly dependent on the diet [(Rose et al., 2015; Zhao et al., 2022)](https://www.zotero.org/google-docs/?STrgFM). Filamentous dung fungi have adapted to use the resistant lignocellulose fraction found in faeces, which explains their preference for herbivore dung. Their adaptation to this substrate, with high Nitrogen content, fast pH changes and high bacterial concentrations could make them a suitable additive to add to composting toilets to increase degradation speed of faecal material. Despite their presence being well described on herbivore dung, actual physiochemical changes and influence on dung inhabiting microbes have rarely been studied. Fungal derived molecules have been used in antibiotics and fungal extracts of many species have been shown potential against a broad range of human pathogenic bacteria [(Hamad et al., 2022; Solomon et al., 2025)](https://www.zotero.org/google-docs/?RkdDUf). However the growth of fungi on human faeces as a direct treatment method in composting toilets has not scientifically been investigated. Within this experiment we tested if filamentous fungi are able to colonize human faecal material mixed with wood chips bulking agent. In order to see if natural specialization is important for their growth possibilities fungi from different ecological niches have been tested. As representatives of dung inhabiting fungi *Sordaria fimicola*, *Coprinopsis* xy, coprinopsis xy2 as dung associated fungi, were tested. *Coprinus comata* a widely cultivated soil inhabiting fungus and indicator of high Nitrogen content (...) in the soil was, *Trichoderma harzianum* and *T. koningii* well known biocontrol agents known for parasitism and their fast and aggressive growth (...), as representatives for wood inhabiting white rot fungi the widely grown mushrooms *G. lucidum* and *P. ostreatus* due to their shown antibacterial properties and worldwide availability. We measured their rate of successful substrate colonization, growth speed and their influence on substrate pH and E. coli concentration and their influence on weight in a two week plate assay.

# Material and Methods

### Fungal strains used

**Cultivable Mushroom isolates**

Strains P. ostreatus, P. ostreatus v. Floridae, C. comatus, G. lucidum were commercially obtained from (Mycogenetics Germany).

Dung inhabiting fungi S. fimicola was isolated from human faecal samples by adding mycelium to a MEA plate.

Coprinopsis species were isolated from horse dung by cutting out a piece of the fruiting body and putting it on the MEA plate with added chloramphenicol.

Storage and inoculum preparation

To maintain fungal cultures during the experimental time every two weeks samples were inoculated to a new MEA plate, inoculated at 25°C.

### Faecal material collection and substrate preparation

Faecal samples from one individual were used throughout the experiment. Faeces were collected using a faecal catcher(Abbexa, Cabmridge ,UK) and transferred into a 3 liter freezing bag (freshstar clic-lock, Galaxus) and stored in an airtight box (Rothobox 3 Liter, Galaxus) and directly put in the fridge at 5°C. The collected faecal samples were stored max 1 day at 5°C.

Sample preparation

Pure faecal samples were weighted and homogenised by kneading in an aseptic freezing bag for approximately 2 min. Pure faecal samples were then transferred into a piping bag and distributed on plates 20±2g per plate. The plates were evenly streaked using a sterile spatula.

For the wood chip mixed samples, beechwood chips (Chipsi, beech wood chips fine, Galaxus ) were added at a 2:1 ratio. The mass was homogenised again by kneading by hand for 2 min. Mixed faecal samples were transferred to plates using a sterile plastic spatula. The mixed solution (15±2g) was added to each plate and evenly distributed.

### Inoculation

Plates were inoculated immediately after preparation using 6mm agar plugs from fungal colonized 14days old MEA plate. The plates were photographed using an iPhone (....) on a pole at fixed distance. As an identifier for each picture, a QR code was placed next to the plate identifying the fungal species, experiment ID, and inoculum ID. Pictures were taken at 0dpi, 7 dpi and 14 dpi. Pictures were analysed using ImageJ (v) to measure the area of the mycelium plot by manually drawing lines around the growth area. The scale was set to 222.09 pixels per cm according to the measurement of a ruler in the same setting. Plates that were fully colonised were set to a calculated max value 0f 63.(...). If the mycelium died, the old value was maintained to keep the maximum spread of the mycelium at 14 dpi. If no growth occurred, the value was set to the original plug value from the 0dpi picture. Visual contaminations were measured in the same way.

Fungal mycelium quality was rated on a scale of 0-5.

0: no mycelium; 1: fully necrotic; 2: partly necrotic; 3: loose mycelium; 4: healthy dense mycelium substrate still visible; 5: very dense mycelium with almost no substrate visible.

Illustrated scale figure

(include example picture of scale here)

### pH measurements

At day 14 dpi, a subsample of each plate was removed and dissolved in dest. water 1:2 (w/v). A pH meter (LGG- ph meter…) was used to measure the pH of the diluted sample.

### E. coli concentration measurements

A sample of approximately 1 g was filled into a 15 ml centrifuge tube (...), and it was dissolved in 5 ml 0.85% NaCl solution. Further dilutions, if needed, were done using 0.85% NaCl in reaction tubes 2 ml (...). After streaking, samples were immediately put back into the fridge in case too high or too low colony counts were reached and repeated the next day. Samples were plated out on TBX chromogenic agar (Roth,(...)) The plates were incubated overnight at 40°C. And blue colonies were counted the next day.

### Data analysis

The data set was analysed using RStudio v2024.04.1 software.

Data pertaining to growth success were filtered by excluding single-replicate data points, retaining only those with three or more biological replicates. Growth was deemed successful when the mycelium covered an area greater than 10 cm2 at 14 days post-inoculation (dpi). Area coverage analysis was filtered to include only data points with at least three biological replicates demonstrating growth greater than 10, thereby excluding poor-growing and non-growing fungi. For E. coli, pH, and weight loss analyses, data were filtered to retain only those with growth greater than 10 at 14 dpi. Control treatments were categorised into two groups: control without fungal contaminant and control with fungal contaminant. Fungal-inoculated plates that did not exhibit growth were pooled into one category, while fungal plates with contamination exceeding 20 were categorised as inoculated but contaminated.

# Data Overview

## Experimental Design

This study evaluates the effectiveness of various fungal species in treating faecal material over a 14-day period. This analysis focuses specifically on Experiment 1_2, which provides the most complete dataset for comprehensive analysis.

### Fungal Species Tested

The following fungal species were selected based on their known decomposition capabilities and potential for faecal treatment applications:

-   **F35 Sordaria** - A saprophytic ascomycete known for cellulose degradation
-   **G. lucidum** - Medicinal mushroom with lignolytic enzymes
-   **P. ostreatus columbinus** - Oyster mushroom variant with strong decomposition activity
-   **P. ostreatus** - Common oyster mushroom with strong lignolytic activity
-   **P. ostreatus v.F** - Florida variant of oyster mushroom
-   **F40** - Fungal isolate with potential decomposition capabilities
-   **F15 Faecal isolate 1** - Indigenous isolate adapted to faecal substrate
-   **F31 Mucor spp I3** - Zygomycete with rapid growth characteristics
-   **T. harzianum CBS245.93** - Commercial biocontrol strain
-   **T. harzianum T22** - Well-characterized agricultural strain
-   **T. koningii** - Trichoderma species with cellulase production
-   **Coprinus comata** - Coprophilic mushroom naturally occurring on dung
-   **Control (ctrl)** - Untreated faecal material for baseline comparison

### Measurements and Variables

#### Primary Response Variables

1.  **Growth Success** (0-5 scale)
    -   0: No visible growth
    -   1-3: Growth with contamination (varying degrees)
    -   4-5: Successful growth without contamination
    -   Measured at 7 and 14 days post-inoculation (DPI)
2.  **Growth Area** (mm²)
    -   Quantitative measurement of fungal colony size
    -   Measured for samples showing successful growth
    -   Log-transformed for statistical analysis due to exponential growth patterns
3.  **Weight Change** (%)
    -   Percentage change from initial weight (0 DPI) to final weight (14 DPI)
    -   Calculated as: ((weight₁₄ - weight₀) / weight₀) × 100
    -   Negative values indicate decomposition/mass loss
4.  **Dry Weight Change** (g and %)
    -   Calculated using water content measurements
    -   Dry weight₀ = weight₀ × (1 - water_content₀/100)
    -   Dry weight₁₄ = weight₁₄ × (1 - water_content₁₄/100)
    -   More accurate measure of actual biomass decomposition
5.  **pH Changes**
    -   pH measured at baseline (0 DPI from faecal samples) and 14 DPI
    -   Important indicator of decomposition processes and microbial activity
6.  **E. coli Concentration** (CFU/g)
    -   Bacterial load measured via plate counts with serial dilutions
    -   Log₁₀ transformed for analysis due to exponential nature of bacterial growth
    -   Key indicator of pathogen reduction efficacy
7.  **E. coli Log Reduction**
    -   Calculated as: log₁₀(baseline) - log₁₀(14 DPI)
    -   Positive values indicate bacterial reduction
    -   Standard metric for antimicrobial efficacy assessment

#### Experimental Structure

-   **Replicates**: Multiple technical replicates per species per experiment
-   **Faecal Samples**: Multiple different faecal source materials (biological replicates)
-   **Time Points**: Measurements at 0, 7, and 14 days post-inoculation
-   **Controls**: Untreated samples for comparison across all metrics

#### Data Filtering and Quality Control

For statistical analyses, samples were filtered based on growth success categories:

-   **Controls**: Only "no growth/no contamination" and "growth/contaminated" samples included
-   **Fungal Treatments**: Only samples with successful growth (with or without contamination) included
-   **Exclusions**: Samples with technical failures, missing measurements, or extreme outliers

This filtering ensures that comparisons are made between functionally equivalent sample types and reduces bias from experimental artifacts.

#### Statistical Considerations

-   **Mixed-effects models** account for multiple measurements from the same faecal samples
-   **Log transformations** applied to microbial data and growth measurements
-   **Non-parametric methods** used when data distributions violate normality assumptions
-   **Multiple comparison corrections** applied for post-hoc tests
-   **Effect sizes** reported alongside p-values for practical significance assessment

```{r setup, include=FALSE}
# ============================================
# LOAD REQUIRED LIBRARIES
# ============================================
library(tidyverse)    # Data manipulation and visualization
library(ggplot2)      # Advanced plotting
library(knitr)        # Report generation
library(kableExtra)   # Enhanced tables
library(gridExtra)    # Plot arrangements
library(scales)       # Scale functions for plots

# ============================================
# DEFINE HELPER FUNCTIONS
# ============================================

# Function to create treatment categories consistently
categorize_treatment <- function(data) {
  data %>%
    mutate(
      treatment_category = case_when(
        species == "ctrl" & growth_status_14dpi == "No growth, no contamination" ~ 
          "Control: No growth, no contamination",
        species == "ctrl" & growth_status_14dpi == "Growth, contaminated" ~ 
          "Control: Growth, contaminated",
        species != "ctrl" & growth_status_14dpi == "Growth, no contamination" ~ 
          species,
        species != "ctrl" & growth_status_14dpi == "Growth, contaminated" ~ 
          paste0(species, " (contaminated)"),
        TRUE ~ "Other"
      )
    ) %>%
    filter(treatment_category != "Other")
}

# Function to add sample and faecal counts to data
add_count_labels <- function(data, group_var = "treatment_category") {
  data %>%
    group_by(across(all_of(group_var))) %>%
    mutate(
      n_samples = n(),
      n_faecal = n_distinct(id_faeces)
    ) %>%
    ungroup()
}

# Function to create custom labels with counts
create_count_labels <- function(data, category_var = "treatment_category") {
  data %>%
    distinct(across(all_of(c(category_var, "n_samples", "n_faecal")))) %>%
    mutate(custom_label = paste0(!!sym(category_var), " (n=", n_samples, ", f=", n_faecal, ")"))
}

# Function to apply custom labels to factor
apply_custom_labels <- function(data, labels_df, category_var = "treatment_category") {
  data %>%
    left_join(labels_df, by = c(category_var, "n_samples", "n_faecal")) %>%
    mutate(!!sym(category_var) := factor(custom_label, 
                                         levels = labels_df %>%
                                           arrange(match(!!sym(category_var), levels(!!sym(category_var)))) %>%
                                           pull(custom_label)))
}

# Function to create summary statistics table
create_summary_table <- function(data, group_var, value_var, caption) {
  data %>%
    group_by(!!sym(group_var)) %>%
    summarise(
      n = n(),
      mean = round(mean(!!sym(value_var), na.rm = TRUE), 2),
      sd = round(sd(!!sym(value_var), na.rm = TRUE), 2),
      median = round(median(!!sym(value_var), na.rm = TRUE), 2),
      min = round(min(!!sym(value_var), na.rm = TRUE), 2),
      max = round(max(!!sym(value_var), na.rm = TRUE), 2),
      .groups = "drop"
    ) %>%
    kable(caption = caption,
          col.names = c(str_to_title(group_var), "n", "Mean", "SD", "Median", "Min", "Max")) %>%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
                  full_width = FALSE)
}

# ============================================
# DEFINE VISUALIZATION THEMES AND COLORS
# ============================================

# Color palettes
experiment_colors <- c("Experiment 1_1" = "#2166AC", "Experiment 1_2" = "#B2182B")
species_colors <- c("P. ostreatus columbinus" = "#2166AC", "G. lucidum" = "#B2182B")

# Define publication theme
theme_publication <- function() {
  theme_minimal(base_size = 10) +
  theme(
    axis.title = element_text(size = 11, face = "bold"),
    axis.text = element_text(size = 9, color = "black"),
    axis.text.y = element_text(size = 9, lineheight = 0.8),
    plot.title = element_text(size = 12, face = "bold", hjust = 0),
    plot.subtitle = element_text(size = 10, hjust = 0, color = "gray30"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(color = "grey90", size = 0.3),
    panel.border = element_rect(color = "black", fill = NA, size = 0.5),
    plot.margin = margin(t = 10, r = 10, b = 10, l = 10, unit = "pt"),
    legend.title = element_text(size = 10, face = "bold"),
    legend.text = element_text(size = 9)
  )
}

# ============================================
# LOAD AND VALIDATE DATA
# ============================================

# Load processed datasets
experiment_1_2 <- read_csv("../data/processed/experiment_1_2_joined.csv", 
                          show_col_types = FALSE)
experiment_1_2_filtered <- read_csv("../data/processed/experiment_1_2_ph_weight_ecoli.csv", 
                                   show_col_types = FALSE)

# Data quality summary
data_summary <- tribble(
  ~"Dataset", ~"Total Samples", ~"Filtered Samples", ~"Species Count",
  "Experiment 1_2", nrow(experiment_1_2), nrow(experiment_1_2_filtered), 
  n_distinct(experiment_1_2$species)
)

kable(data_summary, caption = "Data Quality Summary") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

# Growth Analysis

## Growth Success

```{r growth-success-analysis}
# ============================================
# PREPARE GROWTH SUCCESS DATA
# ============================================

# Transform growth data to long format
growth_success_data <- experiment_1_2 %>%
  select(id_treatment, species, growth_description_7dpi, growth_description_14dpi) %>%
  pivot_longer(
    cols = matches("growth_description_\\d+dpi"),
    names_to = "time_point",
    values_to = "growth_description",
    names_pattern = "growth_description_(\\d+)dpi"
  ) %>%
  mutate(
    time_point = paste0(time_point, " DPI"),
    growth_description = factor(growth_description),
    experiment = "Experiment 1_2"
  ) %>%
  drop_na(growth_description)

# Calculate success proportions
growth_success_summary <- growth_success_data %>%
  count(species, time_point, growth_description) %>%
  add_count(species, time_point, wt = n, name = "total") %>%
  mutate(percentage = (n / total) * 100)

# Order species by success rate
species_order <- growth_success_summary %>%
  filter(time_point == "14 DPI", growth_description %in% c(4, 5)) %>%
  group_by(species) %>%
  summarise(success_rate = sum(percentage), .groups = "drop") %>%
  arrange(desc(success_rate)) %>%
  pull(species)

growth_success_summary <- growth_success_summary %>%
  mutate(species = factor(species, levels = species_order))

# Calculate replicate counts
replicate_info <- growth_success_data %>%
  count(species, time_point, name = "n_replicates") %>%
  mutate(
    label = paste0("n=", n_replicates),
    percentage = 101  # Position above bars
  )
```

```{r growth-success-plot, fig.height=10, fig.width=12}
# ============================================
# CREATE GROWTH SUCCESS PLOT (PRESERVING ORIGINAL AESTHETICS)
# ============================================

plot_exp2 <- growth_success_summary %>%
  ggplot(aes(x = time_point, y = percentage, fill = as.character(growth_description))) +
  geom_col(position = "stack") +
  geom_text(data = replicate_info, 
            aes(x = time_point, y = percentage, label = label),
            inherit.aes = FALSE, size = 2.5, vjust = -0.5) +
  facet_wrap(~ species, ncol = 5) +
  scale_fill_manual(values = c("0" = "#d73027", 
                              "1" = "#fc8d59", 
                              "2" = "#fee090",
                              "3" = "#e0f3f8", 
                              "4" = "#91bfdb", 
                              "5" = "#4575b4"),
                    name = "Growth Description",
                    labels = c("0" = "0: No growth",
                              "1" = "1: Fully necrotic",
                              "2" = "2: Partly necrotic",
                              "3" = "3: Loose mycelium",
                              "4" = "4: Healthy dense",
                              "5" = "5: Very dense")) +
  labs(title = "Fungal Growth Success Over Time - Experiment 1_2",
       subtitle = "Growth description scale: 0 (no growth) to 5 (very dense mycelium)",
       x = "Time Point",
       y = "Percentage of Samples") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom",
        legend.title = element_text(size = 10, face = "bold"),
        legend.text = element_text(size = 8),
        strip.text = element_text(size = 8, face = "bold"),
        panel.spacing = unit(1, "lines")) +
  ylim(0, 105)

print(plot_exp2)

# Summary statistics
growth_success_data %>%
  filter(time_point == "14 DPI") %>%
  group_by(species) %>%
  summarise(
    n_total = n(),
    n_success = sum(growth_description %in% c(4, 5)),
    success_rate = round((n_success / n_total) * 100, 1),
    mean_score = round(mean(as.numeric(as.character(growth_description))), 2),
    .groups = "drop"
  ) %>%
  arrange(desc(success_rate)) %>%
  kable(caption = "Growth Success Summary at 14 DPI",
        col.names = c("Species", "Total", "Successful", "Success Rate (%)", "Mean Score")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Growth Area

```{r area-analysis}
# ============================================
# PREPARE AND ANALYZE GROWTH AREA DATA
# ============================================

# Transform area data to long format
area_data <- experiment_1_2 %>%
  filter(area_size_14dpi > 0) %>%
  select(id_treatment, species, area_size_7dpi, area_size_14dpi, id_faeces) %>%
  pivot_longer(
    cols = matches("area_size_\\d+dpi"),
    names_to = "time_point",
    values_to = "area_size",
    names_pattern = "area_size_(\\d+)dpi"
  ) %>%
  mutate(time_point = paste0(time_point, " DPI")) %>%
  drop_na(area_size) %>%
  filter(area_size > 0)

# Order species by median area at 14 DPI
area_order <- area_data %>%
  filter(time_point == "14 DPI") %>%
  group_by(species) %>%
  summarise(median_area = median(area_size), .groups = "drop") %>%
  arrange(desc(median_area)) %>%
  pull(species)

# Prepare data with counts and labels
area_plot_data <- area_data %>%
  mutate(
    species = factor(species, levels = rev(area_order)),
    species_time = paste0(species, " - ", time_point)
  ) %>%
  add_count_labels("species_time") %>%
  mutate(
    custom_label = paste0(species, " - ", time_point, " (n=", n_samples, ", f=", n_faecal, ")"),
    species_time = factor(custom_label, levels = unique(custom_label)[order(species, desc(time_point))])
  )
```

```{r area-plot, fig.height=8, fig.width=10}
# ============================================
# CREATE AREA PLOT (PRESERVING ORIGINAL AESTHETICS)
# ============================================

area_plot_exp2 <- ggplot(area_plot_data, aes(x = area_size, y = species_time)) +
  geom_boxplot(fill = "darkgreen", alpha = 0.6, color = "darkgreen") +
  geom_point(alpha = 0.6, size = 1, color = "darkred", position = position_jitter(height = 0.2)) +
  labs(
    title = "Fungal Growth Area Distribution by Species and Time Point",
    subtitle = "n = number of observations, f = number of faecal samples",
    x = "Area Size (log scale)",
    y = "Species - Time Point"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 7, lineheight = 0.8),
    axis.text.x = element_text(size = 8),
    panel.grid.major.y = element_line(color = "grey90"),
    panel.grid.minor = element_blank(),
    plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")
  ) +
  scale_x_log10(breaks = c(1, 10, 100, 1000, 10000),
                labels = comma)

print(area_plot_exp2)

# Summary statistics
area_data %>%
  filter(time_point == "14 DPI") %>%
  create_summary_table("species", "area_size", "Growth Area Summary at 14 DPI (mm²)")
```

## pH Analysis

```{r ph-analysis}
# ============================================
# PREPARE pH DATA WITH OPTIMIZED PIPELINE
# ============================================

# Create pH data with treatment categories
ph_data <- experiment_1_2_filtered %>%
  filter(!is.na(ph_14dpi)) %>%
  categorize_treatment() %>%
  rename(ph_value = ph_14dpi)

# Calculate ordering
ph_order <- ph_data %>%
  group_by(treatment_category) %>%
  summarise(median_ph = median(ph_value), .groups = "drop") %>%
  arrange(median_ph) %>%
  pull(treatment_category)

# Prepare plot data with labels
ph_plot_data <- ph_data %>%
  mutate(treatment_category = factor(treatment_category, levels = rev(ph_order))) %>%
  add_count_labels()

# Create and apply custom labels
ph_labels <- create_count_labels(ph_plot_data)
ph_plot_data <- apply_custom_labels(ph_plot_data, ph_labels)
```

```{r ph-plot, fig.height=8, fig.width=10}
# ============================================
# CREATE pH PLOT (PRESERVING ORIGINAL AESTHETICS)
# ============================================

ph_plot_exp2 <- ggplot(ph_plot_data, aes(x = ph_value, y = treatment_category)) +
  geom_vline(xintercept = 7, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  geom_boxplot(fill = "#B2182B", alpha = 0.7, color = "black", size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5, position = position_jitter(height = 0.2)) +
  labs(
    title = "pH Distribution at 14 DPI by Treatment",
    subtitle = "Dashed line indicates neutral pH (7.0); n = number of samples, f = number of faecal sources",
    x = "pH Value",
    y = "Treatment Category"
  ) +
  theme_publication() +
  theme(
    axis.text.y = element_text(size = 8),
    panel.grid.major.x = element_line(color = "grey90", size = 0.3)
  ) +
  scale_x_continuous(breaks = seq(4, 10, 0.5), limits = c(4, 10))

print(ph_plot_exp2)

# Summary statistics
experiment_1_2_filtered %>%
  filter(!is.na(ph_14dpi)) %>%
  mutate(ph_change = ph_14dpi - ph_0dpi) %>%
  group_by(species) %>%
  summarise(
    n = n(),
    mean_initial = round(mean(ph_0dpi, na.rm = TRUE), 2),
    mean_final = round(mean(ph_14dpi, na.rm = TRUE), 2),
    mean_change = round(mean(ph_change, na.rm = TRUE), 2),
    .groups = "drop"
  ) %>%
  arrange(desc(mean_change)) %>%
  kable(caption = "pH Changes from 0 to 14 DPI",
        col.names = c("Species", "n", "Mean pH (0 DPI)", "Mean pH (14 DPI)", "Mean Change")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Weight Change Analysis

```{r weight-analysis}
# ============================================
# PREPARE WEIGHT CHANGE DATA
# ============================================

# Create weight data with treatment categories
weight_data <- experiment_1_2_filtered %>%
  filter(!is.na(weight_percent_change)) %>%
  categorize_treatment()

# Calculate ordering
weight_order <- weight_data %>%
  group_by(treatment_category) %>%
  summarise(median_change = median(weight_percent_change), .groups = "drop") %>%
  arrange(median_change) %>%
  pull(treatment_category)

# Prepare plot data
weight_plot_data <- weight_data %>%
  mutate(treatment_category = factor(treatment_category, levels = rev(weight_order))) %>%
  add_count_labels()

# Create and apply labels
weight_labels <- create_count_labels(weight_plot_data)
weight_plot_data <- apply_custom_labels(weight_plot_data, weight_labels)
```

```{r weight-plot, fig.height=8, fig.width=10}
# ============================================
# CREATE WEIGHT CHANGE PLOT (PRESERVING ORIGINAL AESTHETICS)
# ============================================

weight_change_plot_exp2 <- ggplot(weight_plot_data, aes(x = weight_percent_change, y = treatment_category)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  geom_boxplot(fill = "#FF7F00", alpha = 0.7, color = "black", size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5, position = position_jitter(height = 0.2)) +
  labs(
    title = "Weight Change (%) at 14 DPI by Treatment",
    subtitle = "Negative values indicate weight loss; n = number of samples, f = number of faecal sources",
    x = "Weight Change (%)",
    y = "Treatment Category"
  ) +
  theme_publication() +
  theme(
    axis.text.y = element_text(size = 8),
    panel.grid.major.x = element_line(color = "grey90", size = 0.3)
  ) +
  scale_x_continuous(breaks = seq(-60, 20, 10))

print(weight_change_plot_exp2)
```

## Dry Weight Change Analysis

```{r dry-weight-analysis, fig.height=8, fig.width=10}
# ============================================
# ANALYZE DRY WEIGHT CHANGES
# ============================================

# Prepare dry weight data
dry_weight_data <- weight_data %>%
  filter(!is.na(dry_weight_percent_change))

# Use same ordering as weight change
dry_weight_plot_data <- dry_weight_data %>%
  mutate(treatment_category = factor(treatment_category, levels = rev(weight_order))) %>%
  add_count_labels()

# Create and apply labels
dry_weight_labels <- create_count_labels(dry_weight_plot_data)
dry_weight_plot_data <- apply_custom_labels(dry_weight_plot_data, dry_weight_labels)

# Create plot (PRESERVING ORIGINAL AESTHETICS)
dry_weight_change_plot_exp2 <- ggplot(dry_weight_plot_data, aes(x = dry_weight_percent_change, y = treatment_category)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  geom_boxplot(fill = "#984EA3", alpha = 0.7, color = "black", size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5, position = position_jitter(height = 0.2)) +
  labs(
    title = "Dry Weight Change (%) at 14 DPI by Treatment",
    subtitle = "Negative values indicate dry matter loss; n = number of samples, f = number of faecal sources",
    x = "Dry Weight Change (%)",
    y = "Treatment Category"
  ) +
  theme_publication() +
  theme(
    axis.text.y = element_text(size = 8),
    panel.grid.major.x = element_line(color = "grey90", size = 0.3)
  ) +
  scale_x_continuous(breaks = seq(-100, 50, 10))

print(dry_weight_change_plot_exp2)

# Combined weight summary
weight_data %>%
  group_by(species) %>%
  summarise(
    n = n(),
    mean_wet_change = round(mean(weight_percent_change, na.rm = TRUE), 1),
    mean_dry_change = round(mean(dry_weight_percent_change, na.rm = TRUE), 1),
    .groups = "drop"
  ) %>%
  arrange(mean_wet_change) %>%
  kable(caption = "Weight Change Summary by Species",
        col.names = c("Species", "n", "Mean Wet Change (%)", "Mean Dry Change (%)")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Water Content Analysis

```{r water-content-analysis, fig.height=10, fig.width=10}
# ============================================
# ANALYZE WATER CONTENT CHANGES
# ============================================

# Prepare water content data
water_data <- experiment_1_2_filtered %>%
  filter(!is.na(water_content_0dpi) & !is.na(water_content_14dpi)) %>%
  mutate(water_content_change = water_content_14dpi - water_content_0dpi) %>%
  categorize_treatment()

# Create long format for time comparison
water_long <- water_data %>%
  select(id_treatment, treatment_category, water_content_0dpi, water_content_14dpi) %>%
  pivot_longer(
    cols = c(water_content_0dpi, water_content_14dpi),
    names_to = "time_point",
    values_to = "water_content",
    names_pattern = "water_content_(\\d+)dpi"
  ) %>%
  mutate(time_point = paste0(str_extract(time_point, "\\d+"), " DPI"))

# Calculate ordering
water_order <- water_data %>%
  group_by(treatment_category) %>%
  summarise(median_change = median(water_content_change, na.rm = TRUE), .groups = "drop") %>%
  arrange(median_change) %>%
  pull(treatment_category)

water_data <- water_data %>%
  mutate(treatment_category = factor(treatment_category, levels = rev(water_order)))

# Create plots (PRESERVING ORIGINAL AESTHETICS)
water_change_plot <- ggplot(water_data, aes(x = water_content_change, y = treatment_category)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  geom_boxplot(fill = "#4DAF4A", alpha = 0.7, color = "black", size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5, position = position_jitter(height = 0.2)) +
  labs(
    title = "A) Water Content Change from 0 to 14 DPI",
    subtitle = "Positive values indicate moisture gain",
    x = "Water Content Change (%)",
    y = "Treatment Category"
  ) +
  theme_publication() +
  theme(axis.text.y = element_text(size = 8))

water_timepoint_plot <- ggplot(water_long, aes(x = time_point, y = water_content, fill = treatment_category)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  labs(
    title = "B) Water Content Distribution at 0 and 14 DPI",
    subtitle = "Comparison of initial and final water content",
    x = "Time Point",
    y = "Water Content (%)"
  ) +
  theme_publication() +
  theme(
    legend.position = "right",
    legend.title = element_blank(),
    legend.text = element_text(size = 7)
  ) +
  scale_fill_brewer(palette = "Set3")

# Display both plots (PRESERVING ORIGINAL AESTHETICS)
library(gridExtra)
grid.arrange(water_change_plot, water_timepoint_plot, ncol = 1, heights = c(1, 1.2))
```

## E. coli Concentration Analysis

```{r ecoli-concentration-analysis}
# ============================================
# ANALYZE E. COLI CONCENTRATIONS
# ============================================

# Prepare E. coli data
ecoli_data <- experiment_1_2_filtered %>%
  filter(!is.na(ecoli_conc) & ecoli_conc >= 0) %>%
  mutate(log_ecoli_14dpi = log10(ecoli_conc + 1)) %>%
  categorize_treatment()

# Calculate ordering
ecoli_order <- ecoli_data %>%
  group_by(treatment_category) %>%
  summarise(median_ecoli = median(log_ecoli_14dpi), .groups = "drop") %>%
  arrange(median_ecoli) %>%
  pull(treatment_category)

# Prepare plot data
ecoli_plot_data <- ecoli_data %>%
  mutate(
    treatment_category = factor(treatment_category, levels = rev(ecoli_order)),
    ecoli_concentration_plot = log_ecoli_14dpi
  ) %>%
  add_count_labels()

# Create and apply labels
ecoli_labels <- create_count_labels(ecoli_plot_data)
ecoli_plot_data <- apply_custom_labels(ecoli_plot_data, ecoli_labels)
```

```{r ecoli-concentration-plot, fig.height=8, fig.width=10}
# ============================================
# CREATE E. COLI CONCENTRATION PLOT (PRESERVING ORIGINAL AESTHETICS)
# ============================================

ecoli_conc_plot_exp2 <- ggplot(ecoli_plot_data, aes(x = ecoli_concentration_plot, y = treatment_category)) +
  geom_boxplot(fill = "#B2182B", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  geom_point(alpha = 0.5, size = 1.5, position = position_jitter(height = 0.2)) +
  labs(
    title = "E. coli Concentration at 14 DPI by Treatment",
    subtitle = "Log10 scale; n = number of samples, f = number of faecal sources",
    x = "E. coli Concentration (log10 CFU/g + 1)",
    y = "Treatment Category"
  ) +
  theme_publication() +
  theme(
    axis.text.y = element_text(size = 8),
    panel.grid.major.x = element_line(color = "grey90", size = 0.3)
  ) +
  scale_x_continuous(breaks = 0:10)

print(ecoli_conc_plot_exp2)
```

## E. coli Log Change Analysis

```{r ecoli-log-change-analysis}
# ============================================
# ANALYZE E. COLI LOG CHANGES
# ============================================

# Calculate log changes
ecoli_change_data <- experiment_1_2_filtered %>%
  filter(!is.na(ecoli_conc) & ecoli_conc >= 0 & 
         !is.na(ecoli_conc_mean_0dpi) & ecoli_conc_mean_0dpi > 0) %>%
  mutate(
    log_ecoli_0dpi = log10(ecoli_conc_mean_0dpi),
    log_ecoli_14dpi = log10(ecoli_conc + 1),
    ecoli_log_change = log_ecoli_14dpi - log_ecoli_0dpi
  ) %>%
  categorize_treatment()

# Calculate ordering
ecoli_change_order <- ecoli_change_data %>%
  group_by(treatment_category) %>%
  summarise(median_change = median(ecoli_log_change), .groups = "drop") %>%
  arrange(median_change) %>%
  pull(treatment_category)

# Prepare plot data
ecoli_change_plot_data <- ecoli_change_data %>%
  mutate(treatment_category = factor(treatment_category, levels = rev(ecoli_change_order))) %>%
  add_count_labels()

# Create and apply labels
ecoli_change_labels <- create_count_labels(ecoli_change_plot_data)
ecoli_change_plot_data <- apply_custom_labels(ecoli_change_plot_data, ecoli_change_labels)
```

```{r ecoli-log-change-plot, fig.height=8, fig.width=10}
# ============================================
# CREATE E. COLI LOG CHANGE PLOT (PRESERVING ORIGINAL AESTHETICS)
# ============================================

ecoli_log_change_plot_exp2 <- ggplot(ecoli_change_plot_data, aes(x = ecoli_log_change, y = treatment_category)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  geom_vline(xintercept = -1, linetype = "dotted", color = "darkgreen", size = 0.5, alpha = 0.5) +
  geom_vline(xintercept = -3, linetype = "dotted", color = "darkgreen", size = 0.5, alpha = 0.7) +
  geom_boxplot(fill = "#2166AC", alpha = 0.7, color = "black", size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5, position = position_jitter(height = 0.2)) +
  labs(
    title = "E. coli Log Change from 0 to 14 DPI",
    subtitle = "Negative values indicate bacterial reduction; dotted lines at 1 and 3 log reduction",
    x = "Log10 Change in E. coli Concentration",
    y = "Treatment Category"
  ) +
  theme_publication() +
  theme(
    axis.text.y = element_text(size = 8),
    panel.grid.major.x = element_line(color = "grey90", size = 0.3)
  ) +
  scale_x_continuous(breaks = seq(-8, 2, 1))

print(ecoli_log_change_plot_exp2)

# Summary statistics
ecoli_change_data %>%
  group_by(species) %>%
  summarise(
    n = n(),
    mean_log_reduction = round(mean(-ecoli_log_change, na.rm = TRUE), 2),
    percent_1log = round(sum(ecoli_log_change <= -1) / n() * 100, 1),
    percent_3log = round(sum(ecoli_log_change <= -3) / n() * 100, 1),
    .groups = "drop"
  ) %>%
  arrange(desc(mean_log_reduction)) %>%
  kable(caption = "E. coli Log Reduction Summary",
        col.names = c("Species", "n", "Mean Log Reduction", "% ≥1 log", "% ≥3 log")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Relationship Between Initial Faecal Parameters and Growth Success: P. ostreatus vs G. lucidum

```{r faecal-growth-analysis}
# ============================================
# ANALYZE FAECAL PARAMETERS VS GROWTH SUCCESS
# ============================================

# Focus on two key species
growth_faecal_data <- experiment_1_2 %>%
  filter(species %in% c("P. ostreatus columbinus", "G. lucidum")) %>%
  filter(!is.na(area_size_14dpi)) %>%
  mutate(
    growth_success_binary = factor(ifelse(area_size_14dpi > 10, "1", "0"), levels = c("0", "1")),
    log_ecoli_0dpi = log10(ecoli_conc_mean_0dpi + 1)
  )

# Summary by species and growth
growth_faecal_data %>%
  group_by(species, growth_success_binary) %>%
  summarise(
    n = n(),
    mean_ph = round(mean(ph_0dpi, na.rm = TRUE), 2),
    mean_water = round(mean(water_content_0dpi, na.rm = TRUE), 1),
    mean_log_ecoli = round(mean(log_ecoli_0dpi, na.rm = TRUE), 2),
    .groups = "drop"
  ) %>%
  kable(caption = "Initial Faecal Parameters by Species and Growth Outcome",
        col.names = c("Species", "Growth Success", "n", "Mean pH", "Mean Water %", "Mean Log E.coli")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

```{r faecal-growth-plots, fig.height=12, fig.width=10}
# ============================================
# CREATE COMPARISON PLOTS (PRESERVING ORIGINAL AESTHETICS)
# ============================================

# pH plot
ph_plot <- ggplot(growth_faecal_data, aes(x = growth_success_binary, y = ph_0dpi, fill = species)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  geom_point(aes(color = species), alpha = 0.6, size = 1.5, 
             position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8)) +
  labs(
    title = "A) Initial pH vs Growth Success by Species",
    subtitle = "P. ostreatus vs G. lucidum comparison",
    x = "Growth Outcome",
    y = "pH at 0 DPI",
    fill = "Species",
    color = "Species"
  ) +
  theme_publication() +
  scale_fill_manual(values = species_colors) +
  scale_color_manual(values = species_colors) +
  scale_x_discrete(labels = c("0" = "No Growth\n(≤10 mm²)", "1" = "Growth\n(>10 mm²)"))

# Water content plot
water_plot <- ggplot(growth_faecal_data, aes(x = growth_success_binary, y = water_content_0dpi, fill = species)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  geom_point(aes(color = species), alpha = 0.6, size = 1.5,
             position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8)) +
  labs(
    title = "B) Initial Water Content vs Growth Success by Species",
    subtitle = "P. ostreatus vs G. lucidum comparison",
    x = "Growth Outcome",
    y = "Water Content at 0 DPI (%)",
    fill = "Species",
    color = "Species"
  ) +
  theme_publication() +
  scale_fill_manual(values = species_colors) +
  scale_color_manual(values = species_colors) +
  scale_x_discrete(labels = c("0" = "No Growth\n(≤10 mm²)", "1" = "Growth\n(>10 mm²)"))

# E. coli plot
ecoli_plot <- ggplot(growth_faecal_data, aes(x = growth_success_binary, y = log_ecoli_0dpi, fill = species)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  geom_point(aes(color = species), alpha = 0.6, size = 1.5,
             position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8)) +
  labs(
    title = "C) Initial E. coli Concentration vs Growth Success by Species",
    subtitle = "P. ostreatus vs G. lucidum comparison",
    x = "Growth Outcome",
    y = "Log10(E. coli CFU/g + 1)",
    fill = "Species",
    color = "Species"
  ) +
  theme_publication() +
  scale_fill_manual(values = species_colors) +
  scale_color_manual(values = species_colors) +
  scale_x_discrete(labels = c("0" = "No Growth\n(≤10 mm²)", "1" = "Growth\n(>10 mm²)"))

# Combine plots (PRESERVING ORIGINAL AESTHETICS)
library(gridExtra)
grid.arrange(ph_plot, water_plot, ecoli_plot, ncol = 1)
```

# Summary and Conclusions

This analysis of Experiment 1_2 reveals important insights into the effectiveness of various fungal species for treating faecal material:

1.  **Growth Success**: Several species showed consistent growth on the faecal substrate, with P. ostreatus variants and G. lucidum demonstrating particularly robust colonization.

2.  **pH Changes**: Fungal treatments generally increased pH levels compared to controls, which may influence pathogen survival and decomposition processes.

3.  **Weight Reduction**: Most fungal treatments resulted in significant weight loss, indicating active decomposition of the faecal material.

4.  **E. coli Reduction**: Several fungal species achieved substantial reductions in E. coli concentrations, with some achieving \>3 log reductions, meeting sanitation standards.

5.  **Species-Specific Effects**: P. ostreatus columbinus and G. lucidum showed different sensitivities to initial faecal parameters, suggesting species-specific optimization may be beneficial.

These findings support the potential use of selected fungal species as biological treatment agents for decentralized sanitation systems.
