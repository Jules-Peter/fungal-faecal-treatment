---
title: "Fungal Treatment of Faecal Material: Experiment 1_2 Analysis"
author: "Analysis Report"
date: "`r Sys.Date()`"
format: 
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    theme: cosmo
    cache: true
editor: visual
---

# Introduction

Decentralized sanitation is needed in places where sewered toilets cannot be built due to remote location or no central treatment plants are available. To meet this critical need, a variety of decentralized sanitation technologies have been developed, each with its own approach to safely managing human waste. A primary challenge for these systems is to effectively treat the excreta to inactivate pathogens, control odors, and manage the final end-product in a sustainable and user-friendly way. These solutions range broadly, from simple pit latrines to more engineered systems that separate different waste streams at the source for distinct treatment. One solution for decentralized sanitation is the Urine Diversion Dry Toilet (UDDT), where faeces and urine are collected in separate chambers. Urine is mostly sterile and can be safely handled (...). The collected faecal material is covered using different additives, commonly used are ash, lime, sawdust, soil or other lignocellulosic materials, to help drying out the material faster and avoid bad odour . The dried faecal mixture relies mostly on desiccation for pathogen inactivation, which requires long storage times for up to 1 year depending on conditions, and rewetting can lead to pathogen reactivation (). Due to desiccation the collected material will not degrade faecal material in combination with bulking agents leading to  accumulation of material, still reminiscent of mixed faecal material rather than finished compost [(Tilley et al., 2014)](https://www.zotero.org/google-docs/?8uSl90).  Composting toilets where faecal material is degraded in the collection chamber itself exist. However, in these systems the composting process is hard to control.  Material can become too dry for efficient degradation but not dry enough for pathogen inactivation and temperatures to guarantee pathogen inactivation are not reached [(Redlinger et al., 2001)](https://www.zotero.org/google-docs/?S3S9zR). 

Degradation of faecal material can result in several deadlock states that significantly slow down or completely halt the degradation process. While drying out is one of them others are, the low C:N ratio of about  8:1. The low C:N ratio can cause high pH \>8 which can lead to toxic ammonia production killing microbes and stopping decomposition and leading to bad odour. Especially at ambient temperature ammonia can be assembled in high concentrations in the substrate.Substrate compression and limited amount of crude fibers leading to dense structure creating anaerobic conditions [(Rose et al., 2015)](https://www.zotero.org/google-docs/?IoOqUg), Slowing down the degradation process. Both C:N ratio and aeration could be corrected by addition of lignocellulose material as bulking agents. However, due to the increased surface and the dried material the water content of the faecal mass can become too low for bacteria which need high water activity to effectively grow [(Ahn et al., 2008; Richard et al., 2002)](https://www.zotero.org/google-docs/?sbpYU7). Furthermore,lignocellulosic materials are recalcitrant against bacterial degradation especially if thermophilic conditions are not reached. Addition of lignocellulose after each defaecation leads to a final substrate mostly consisting of lignocellulose rather than faecal material. The high content of lignocellulose could make the material an ideal substrate for fungal growth. Fungi can have a broad adaptation on water content in the substrate and can efficiently grow at lower aW values and a broad range of pH compared to bacteria. Fungi are known for their strong lignocellulose degrading enzymes that are being used in many industries (...). 

Filamentous fungi are an essential part in faecal mass degradation and carbon cycling especially in herbivore dung [(Calaça et al., 2024)](https://www.zotero.org/google-docs/?tzbaqK). A diverse fungal community that grows on dung has been described with certain species entirely dependent on this substrate to reproduce [(Richardson & Watling, 1968)](https://www.zotero.org/google-docs/?2txFvR). Herbivore dung consists of up to 70% of undigested lignocellulosic material and has a nitrogen content of 1.8-3% ([Zhao et al., 2022](https://www.zotero.org/google-docs/?WT7l7t)). Human faeces have a higher Nitrogen content of 5-7% and lower in fibrous material around 25%, but strongly dependent on the diet [(Rose et al., 2015; Zhao et al., 2022)](https://www.zotero.org/google-docs/?STrgFM). Filamentous dung fungi have adapted to use the resistant lignocellulose fraction found in faeces, which explains their preference for herbivore dung. Their adaptation to this substrate, with high Nitrogen content, fast pH changes and high bacterial concentrations could make them a suitable additive to add to composting toilets to increase degradation speed of faecal material. Despite their presence being well described on herbivore dung, actual physiochemical changes and influence on dung inhabiting microbes have rarely been studied. Fungal derived molecules have been used in antibiotics and fungal extracts of many species have been shown potential against a broad range of human pathogenic bacteria [(Hamad et al., 2022; Solomon et al., 2025)](https://www.zotero.org/google-docs/?RkdDUf). However the growth of fungi on human faeces as a direct treatment method in composting toilets has not scientifically been investigated. Within this experiment we tested if filamentous fungi are able to colonize human faecal material mixed with wood chips bulking agent. In order to see if natural specialization is important for their growth possibilities fungi from different ecological niches have been tested. As representatives of dung inhabiting fungi Sordaria fimicola, Coprinopsis xy, coprinopsis xy2  as dung associated fungi, were tested. Coprinus comata a widely cultivated soil inhabiting fungus and indicator of high Nitrogen content (...) in the soil was,  Trichoderma harzianum and T. koningii  well known biocontrol agents known for parasitism and their fast and aggressive growth (...), as representatives for wood inhabiting white rot fungi  the widely grown mushrooms G. lucidum and P. ostreatus due to their shown antibacterial properties and worldwide availability.  We measured their rate of successful substrate colonization, growth speed and their influence on substrate pH and E. coli concentration and their influence on weight in a two week plate assay. 

# Material and Methods

### Fungal strains used

**Cultivable Mushroom isolates**

Strains P. ostreatus, P. ostreatus v. Floridae, C. comatus, G. lucidum were commercially obtained from (Mycogenetics Germany). 

Dung inhabiting fungi S. fimicola was isolated from human faecal samples by adding mycelium to a MEA plate.

Coprinopsis species were isolated from horse dung by cutting out a piece of the fruiting body and putting it on the MEA plate with added chloramphenicol.

Storage and inoculum preparation

To maintain fungal cultures during the experimental time every two weeks samples were inoculated to a new MEA plate, inoculated at 25°C. 

### Faecal material collection and substrate preparation

Faecal samples from one individual were used throughout the experiment. Faeces were collected using a faecal catcher(Abbexa, Cabmbridge ,UK) and transferred into a 3 liter freezing bag (freshstar clic-lock, Galaxus) and stored in an airtight box (Rothobox 3 Liter, Galaxus) and directly put in the fridge at 5°C. The collected faecal samples were stored max 1 day at 5°C.

Sample preparation

Pure faecal samples were weighted and homogenised by kneading in an aseptic freezing bag for approximately  2 min. Pure faecal samples were then transferred into a piping bag and distributed on plates 20±2g per plate. The plates were evenly streaked using a sterile spatula. 

For the wood chip mixed samples, beechwood chips (Chipsi, beech wood chips fine, Galaxus ) were added at a 2:1 ratio. The mass was homogenised again by kneading by hand for 2 min. Mixed faecal samples were transferred to plates using a sterile plastic spatula. The mixed solution (15±2g) was added to each plate and evenly distributed. 

### Inoculation 

Plates were inoculated immediately after preparation using 6mm agar plugs from fungal colonized 14days old MEA plate. The plates were photographed using an iPhone (....) on a pole at fixed distance. As an identifier for each picture, a QR code was placed next to the plate identifying the fungal species, experiment ID, and inoculum ID. Pictures were taken at 0dpi, 7dpi and 14 dpi. Pictures were analysed using ImageJ (v) to measure the area of the mycelium plot by manually drawing lines around the growth area.  The scale was set to 222.09 pixels per cm according to the measurement of a ruler in the same setting. Plates that were fully colonised were set to a calculated max value 0f 63.(...). If the mycelium died, the old value was maintained to keep the maximum spread of the mycelium at 14 dpi. If no growth occurred, the value was set to the original plug value from the 0dpi picture. Visual contaminations were measured in the same way. 

Fungal mycelium quality was rated on a scale of 0-5. 

0: no mycelium; 1: fully necrotic; 2: partly necrotic; 3: loose mycelium; 4: healthy dense mycelium substrate still visible; 5: very dense mycelium with almost no substrate visible. 

Illustrated scale figure 

(include example picture of scale here)

### pH measurements

At day 14 dpi, a subsample of each plate was removed and dissolved in dest. water 1:2 (w/v). A pH meter (LGG- ph meter…) was used to measure the pH of the diluted sample. 

### E. coli concentration measurements

A sample of approximately 1 g was filled into a 15 ml centrifuge tube (...), and it was dissolved in 5 ml 0.85% NaCl solution. Further dilutions, if needed, were done using 0.85% NaCl in reaction tubes 2 ml (...). After streaking, samples were immediately put back into the fridge in case too high or too low colony counts were reached and repeated the next day.  Samples were plated out on TBX chromogenic agar (Roth,(...)) The plates were incubated overnight at 40°C. And blue colonies were counted the next day.

### Data analysis

The data set was analysed using RStudio v2024.04.1 software. 

Data pertaining to growth success were filtered by excluding single-replicate data points, retaining only those with three or more biological replicates. Growth was deemed successful when the mycelium covered an area greater than 10 cm2 at 14 days post-inoculation (dpi). Area coverage analysis was filtered to include only data points with at least three biological replicates demonstrating growth greater than 10, thereby excluding poor-growing and non-growing fungi. For E. coli, pH, and weight loss analyses, data were filtered to retain only those with growth greater than 10 at 14 dpi. Control treatments were categorised into two groups: control without fungal contaminant and control with fungal contaminant. Fungal-inoculated plates that did not exhibit growth were pooled into one category, while fungal plates with contamination exceeding 20 were categorised as inoculated but contaminated.

# Data Overview

## Experimental Design

This study evaluates the effectiveness of various fungal species in treating faecal material over a 14-day period. This analysis focuses specifically on Experiment 1_2, which provides the most complete dataset for comprehensive analysis.

### Fungal Species Tested

The following fungal species were selected based on their known decomposition capabilities and potential for faecal treatment applications:

-   **F35 Sordaria** - A saprophytic ascomycete known for cellulose degradation
-   **G. lucidum** - Medicinal mushroom with lignolytic enzymes
-   **P. ostreatus columbinus** - Oyster mushroom variant with strong decomposition activity
-   **F15 Faecal isolate 1** - Indigenous isolate adapted to faecal substrate
-   **F31 Mucor spp I3** - Zygomycete with rapid growth characteristics
-   **T. harzianum CBS245.93** - Commercial biocontrol strain
-   **T. harzianum T22** - Well-characterized agricultural strain
-   **T. koningii** - Trichoderma species with cellulase production
-   **Coprinus comata** - Coprophilic mushroom naturally occurring on dung
-   **Control (ctrl)** - Untreated faecal material for baseline comparison

### Measurements and Variables

#### Primary Response Variables

1.  **Growth Success** (0-5 scale)
    -   0: No visible growth
    -   1-3: Growth with contamination (varying degrees)
    -   4-5: Successful growth without contamination
    -   Measured at 7 and 14 days post-inoculation (DPI)
2.  **Growth Area** (mm²)
    -   Quantitative measurement of fungal colony size
    -   Measured for samples showing successful growth
    -   Log-transformed for statistical analysis due to exponential growth patterns
3.  **Weight Change** (%)
    -   Percentage change from initial weight (0 DPI) to final weight (14 DPI)
    -   Calculated as: ((weight₁₄ - weight₀) / weight₀) × 100
    -   Negative values indicate decomposition/mass loss
4.  **Dry Weight Change** (g and %)
    -   Calculated using water content measurements
    -   Dry weight₀ = weight₀ × (1 - water_content₀/100)
    -   Dry weight₁₄ = weight₁₄ × (1 - water_content₁₄/100)
    -   More accurate measure of actual biomass decomposition
5.  **pH Changes**
    -   pH measured at baseline (0 DPI from faecal samples) and 14 DPI
    -   Important indicator of decomposition processes and microbial activity
6.  **E. coli Concentration** (CFU/g)
    -   Bacterial load measured via plate counts with serial dilutions
    -   Log₁₀ transformed for analysis due to exponential nature of bacterial growth
    -   Key indicator of pathogen reduction efficacy
7.  **E. coli Log Reduction**
    -   Calculated as: log₁₀(baseline) - log₁₀(14 DPI)
    -   Positive values indicate bacterial reduction
    -   Standard metric for antimicrobial efficacy assessment

#### Experimental Structure

-   **Replicates**: Multiple technical replicates per species per experiment
-   **Faecal Samples**: Multiple different faecal source materials (biological replicates)
-   **Time Points**: Measurements at 0, 7, and 14 days post-inoculation
-   **Controls**: Untreated samples for comparison across all metrics

#### Data Filtering and Quality Control

For statistical analyses, samples were filtered based on growth success categories:

-   **Controls**: Only "no growth/no contamination" and "growth/contaminated" samples included
-   **Fungal Treatments**: Only samples with successful growth (with or without contamination) included
-   **Exclusions**: Samples with technical failures, missing measurements, or extreme outliers

This filtering ensures that comparisons are made between functionally equivalent sample types and reduces bias from experimental artifacts.

#### Statistical Considerations

-   **Mixed-effects models** account for multiple measurements from the same faecal samples
-   **Log transformations** applied to microbial data and growth measurements
-   **Non-parametric methods** used when data distributions violate normality assumptions
-   **Multiple comparison corrections** applied for post-hoc tests
-   **Effect sizes** reported alongside p-values for practical significance assessment

# Results and discussion

## Growth Success

```{r setup, include=FALSE, warning=FALSE}
# Load required libraries
library(tidyverse)
library(ggplot2)
library(knitr)
library(RColorBrewer)
library(scales)
library(ggtext)
library(kableExtra)

# Define professional color palettes
# For experiments comparison

# For treatment categories (using colorblind-friendly palette)
treatment_colors <- c(
  "Control: No growth, no contamination" = "#000000",
  "Control: No growth, contaminated" = "#666666", 
  "Control: Growth, no contamination" = "#999999",
  "Control: Growth, contaminated" = "#CCCCCC",
  "No growth, no contamination" = "#E69F00",
  "No growth, contaminated" = "#56B4E9",
  "Growth, contaminated" = "#009E73",
  "Growth, no contamination" = "#F0E442"
)

# Define theme for publication
theme_publication <- function() {
  theme_minimal(base_size = 10) +
  theme(
    axis.title = element_text(size = 11, face = "bold"),
    axis.text = element_text(size = 9, color = "black"),
    axis.text.y = element_text(size = 9, lineheight = 0.8),
    plot.title = element_text(size = 12, face = "bold", hjust = 0),
    plot.subtitle = element_text(size = 10, hjust = 0, color = "gray30"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(color = "grey90", size = 0.3),
    panel.border = element_rect(color = "black", fill = NA, size = 0.5),
    plot.margin = margin(t = 10, r = 10, b = 10, l = 10, unit = "pt"),
    legend.title = element_text(size = 10, face = "bold"),
    legend.text = element_text(size = 9)
  )
}

# Load the datasets
# Original dataset for growth success analysis (Experiment 1_2 only)
experiment_1_2 <- read.csv("../data/processed/experiment_1_2_joined.csv")

# Specialized filtered dataset for pH, weight change, and E.coli analysis (Experiment 1_2 only)
experiment_1_2_filtered <- read.csv("../data/processed/experiment_1_2_ph_weight_ecoli.csv")
```

```{r data-prep, include=FALSE, warning=FALSE}
# Note: Species filtering is now done in the data processing step
# The dataset already contains only the selected species

# Prepare data for experiment 1_2 only (excluding controls)
growth_success_data <- experiment_1_2 %>%
  filter(species != "ctrl") %>%
  select(id_treatment, species, growth_description_7dpi, growth_description_14dpi) %>%
  pivot_longer(cols = c(growth_description_7dpi, growth_description_14dpi),
               names_to = "time_point",
               values_to = "growth_description") %>%
  mutate(
    time_point = case_when(
      time_point == "growth_description_7dpi" ~ "7 DPI",
      time_point == "growth_description_14dpi" ~ "14 DPI"
    ),
    growth_description = as.factor(growth_description),
    experiment = "Experiment 1_2"
  ) %>%
  filter(!is.na(growth_description))

# Create complete grid to ensure all species appear 
unique_species <- unique(growth_success_data$species)

complete_grid <- expand_grid(
  experiment = "Experiment 1_2",
  species = unique_species,
  time_point = c("7 DPI", "14 DPI"),
  growth_description = factor(0:5)
)

# Calculate percentages and replicate information
growth_success_summary <- growth_success_data %>%
  group_by(experiment, species, time_point, growth_description) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(experiment, species, time_point) %>%
  mutate(
    total = sum(count),
    percentage = (count / total) * 100
  ) %>%
  ungroup() %>%
  # Join with complete grid to include missing combinations
  right_join(complete_grid, by = c("experiment", "species", "time_point", "growth_description")) %>%
  mutate(
    count = replace_na(count, 0),
    total = replace_na(total, 0),
    percentage = replace_na(percentage, 0)
  )

# Calculate replicate and faecal sample information
replicate_info <- growth_success_data %>%
  group_by(experiment, species, time_point) %>%
  summarise(
    n_replicates = n(),
    n_faecal_samples = n_distinct(experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)], na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    label = paste0("n=", n_replicates, "\nf=", n_faecal_samples)
  )

# Add replicate info to summary
growth_success_summary <- growth_success_summary %>%
  left_join(replicate_info, by = c("experiment", "species", "time_point"))
```

```{r growth-success-plot, warning=FALSE}
# Define terrain2 colors for growth descriptions (reversed so 5 is green)
terrain2_colors <- rev(terrain.colors(6, alpha = 1))
custom_colors <- setNames(terrain2_colors, as.character(0:5))

# Define descriptive labels for growth descriptions
growth_labels <- c(
  "0" = "No growth",
  "1" = "Full necrotic", 
  "2" = "Partly necrotic",
  "3" = "Loose mycelium net",
  "4" = "Dense mycelium net", 
  "5" = "Thick mycelium mat with aerial mycelium"
)

# Filter out rows where total is 0 (no data) to avoid empty bars
# and ensure proper ordering of time points
plot_data <- growth_success_summary %>%
  filter(total > 0) %>%
  mutate(time_point = factor(time_point, levels = c("7 DPI", "14 DPI")))

# Create plot for Experiment 1_2 only
plot_data <- plot_data
replicate_info <- replicate_info

plot_exp2 <- plot_data %>%
  ggplot(aes(x = time_point, y = percentage, fill = as.character(growth_description))) +
  geom_col(position = "stack") +
  geom_text(data = replicate_info, 
            aes(x = time_point, y = 105, label = label), 
            inherit.aes = FALSE, size = 2.5, vjust = 0) +
  facet_grid(~ species, scales = "free_y", switch = "x") +
  labs(
    title = "Experiment 1_2: Growth Success by Species and Time Point",
    subtitle = "n = number of replicates, f = number of faecal samples",
    x = "Species",
    y = "Percentage (%)",
    fill = "Growth Description"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 7),
    axis.text.y = element_text(size = 8),
    legend.position = "right",
    strip.text.x = element_text(size = 7, angle = 45, hjust = 0.4, margin = margin(t = 2, b = 0)),
    strip.placement = "outside",
    panel.spacing.x = unit(0.2, "lines"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  scale_fill_manual(values = custom_colors, labels = growth_labels, na.value = "white") +
  scale_y_continuous(limits = c(0, 110), breaks = c(0, 25, 50, 75, 100), labels = c("0", "25", "50", "75", "100")) +
  guides(fill = guide_legend(ncol = 1))

# Display the plot
print(plot_exp2)
```

## Growth Area

```{r growth-area-data, include=FALSE}
# Prepare area size data for Experiment 1_2 only
# Get unique species from the dataset
unique_species <- unique(experiment_1_2$species)

area_data <- experiment_1_2 %>%
  select(id_treatment, species, area_size_7dpi, area_size_14dpi) %>%
  pivot_longer(cols = c(area_size_7dpi, area_size_14dpi),
               names_to = "time_point",
               values_to = "area_size") %>%
  mutate(
    time_point = case_when(
      time_point == "area_size_7dpi" ~ "7 DPI",
      time_point == "area_size_14dpi" ~ "14 DPI"
    ),
    experiment = "Experiment 1_2",
    species_time = paste(species, time_point, sep = " - ")
  ) %>%
  filter(!is.na(area_size) & area_size > 1)

# Create ordered factor for species_time to control y-axis order
create_species_time_factor <- function(data, unique_species) {
  species_time_levels <- c()
  species_time_labels <- c()
  
  for (species in unique_species) {
    # Add levels for this species
    level_7dpi <- paste(species, "7 DPI", sep = " - ")
    level_14dpi <- paste(species, "14 DPI", sep = " - ")
    
    species_time_levels <- c(species_time_levels, level_7dpi, level_14dpi)
    
    # Create labels: species name for 7 DPI, just time point for 14 DPI
    label_7dpi <- paste(species, "7 DPI")
    label_14dpi <- "14 DPI"
    
    species_time_labels <- c(species_time_labels, label_7dpi, label_14dpi)
  }
  
  # Create factor with proper levels and labels
  data$species_time <- factor(data$species_time, levels = rev(species_time_levels))
  
  # Create named vector for labels
  label_mapping <- setNames(rev(species_time_labels), rev(species_time_levels))
  
  return(data)
}

area_data <- create_species_time_factor(area_data, unique_species)

# Calculate sample size information for area data
area_sample_info <- area_data %>%
  group_by(species, time_point) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    species_time = paste(species, time_point, sep = " - "),
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples)
  )
```

```{r growth-area-plots}
# Create custom y-axis labels with sample info on second line
area_labels <- area_sample_info %>%
  arrange(match(species_time, levels(area_data$species_time))) %>%
  mutate(custom_label = paste0(species_time, "\n", sample_label)) %>%
  pull(custom_label)

area_plot_1_1 <- ggplot(area_data, aes(x = area_size, y = species_time)) +
  geom_boxplot(fill = "steelblue", alpha = 0.6, color = "steelblue") +
  geom_point(alpha = 0.6, size = 1, color = "darkblue", position = position_jitter(height = 0.2)) +
  labs(
    subtitle = "n = number of observations, f = number of faecal samples",
    x = "Area Size (log scale)",
    y = "Species - Time Point"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 7, lineheight = 0.8),
    axis.text.x = element_text(size = 8),
    panel.grid.major.y = element_line(color = "grey90"),
    panel.grid.minor = element_blank(),
    plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")
  ) +
  scale_x_continuous(trans = "log10") +
  scale_y_discrete(labels = area_labels)

# Create custom y-axis labels with sample info on second line
area_labels <- area_sample_info %>%
  arrange(match(species_time, levels(area_data$species_time))) %>%
  mutate(custom_label = paste0(species_time, "\n", sample_label)) %>%
  pull(custom_label)

# Create box plot for Experiment 1_2
area_plot_exp2 <- ggplot(area_data, aes(x = area_size, y = species_time)) +
  geom_boxplot(fill = "darkgreen", alpha = 0.6, color = "darkgreen") +
  geom_point(alpha = 0.6, size = 1, color = "darkred", position = position_jitter(height = 0.2)) +
  labs(
    title = "Experiment 1_2: Fungal Growth Area Distribution by Species and Time Point",
    subtitle = "n = number of observations, f = number of faecal samples",
    x = "Area Size (log scale)",
    y = "Species - Time Point"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 7, lineheight = 0.8),
    axis.text.x = element_text(size = 8),
    panel.grid.major.y = element_line(color = "grey90"),
    panel.grid.minor = element_blank(),
    plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")
  ) +
  scale_x_continuous(trans = "log10") +
  scale_y_discrete(labels = area_labels)

# Display the plot
print(area_plot_exp2)
```

## pH Analysis

```{r ph-data, include=FALSE}
# Prepare pH data for Experiment 1_2 (14 DPI only)
# Using the specialized filtered datasets

ph_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, ph_14dpi, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    ph_value = ph_14dpi,
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(ph_value))

ph_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, ph_14dpi, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    experiment = "Experiment 1_2",
    ph_value = ph_14dpi,
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(ph_value))

# Create factor with categories in desired order based on growth status
fixed_categories <- c(
  "Control: No growth, no contamination",
  "Control: No growth, contaminated", 
  "Control: Growth, no contamination",
  "Control: Growth, contaminated",
  "No growth, no contamination",
  "No growth, contaminated",
  "Growth, contaminated"
)

# Get individual species with growth and no contamination
species_with_growth_1_1 <- unique(ph_data$treatment_category[!ph_data$treatment_category %in% fixed_categories])
species_with_growth_1_2 <- unique(ph_data$treatment_category[!ph_data$treatment_category %in% fixed_categories])

# Create category levels including individual species names for growth without contamination
category_levels_1_1 <- c(fixed_categories[fixed_categories %in% unique(ph_data$treatment_category)], 
                         sort(species_with_growth_1_1))
category_levels_1_2 <- c(fixed_categories[fixed_categories %in% unique(ph_data$treatment_category)], 
                         sort(species_with_growth_1_2))

ph_data$treatment_category <- factor(ph_data$treatment_category, levels = rev(category_levels_1_1))
ph_data$treatment_category <- factor(ph_data$treatment_category, levels = rev(category_levels_1_2))

# Calculate sample size information for pH data by category
ph_sample_info <- ph_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )

ph_sample_info <- ph_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )
```

```{r ph-plots, fig.width=8, fig.height=6}
# Create custom y-axis labels with sample info on second line
# Format species names in italics
ph_labels <- ph_sample_info %>%
  arrange(match(treatment_category, levels(ph_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F15", treatment_category) ~ gsub("F15 Faecal isolate 1", "*F15* Faecal isolate 1", treatment_category),
      grepl("F31", treatment_category) ~ gsub("F31 Mucor spp I3", "*F31 Mucor* spp. I3", treatment_category),
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

ph_plot_1_1 <- ggplot(ph_data, aes(x = ph_value, y = treatment_category)) +
  # Add reference line for neutral pH
  geom_vline(xintercept = 7, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  # Box plots with professional colors
  geom_boxplot(fill = "#2166AC", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "A) pH distribution by treatment category (14 DPI) - Experiment 1",
    x = "pH value",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_text(size = 11, face = "bold")
  ) +
  scale_x_continuous(
    limits = c(5, 10), 
    breaks = c(5, 6, 7, 8, 9, 10),
    labels = c("5", "6", "7\n(neutral)", "8", "9", "10")
  ) +
  scale_y_discrete(labels = ph_labels)

# Create custom y-axis labels with sample info on second line
ph_labels <- ph_sample_info %>%
  arrange(match(treatment_category, levels(ph_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("F40", treatment_category) ~ gsub("F40", "*F40*", treatment_category),
      grepl("G\\. lucidum", treatment_category) ~ gsub("G\\. lucidum", "*G. lucidum*", treatment_category),
      grepl("P\\. ostreatus columbinus", treatment_category) ~ gsub("P\\. ostreatus columbinus", "*P. ostreatus* columbinus", treatment_category),
      grepl("P\\. ostreatus", treatment_category) & !grepl("columbinus", treatment_category) ~ gsub("P\\. ostreatus", "*P. ostreatus*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      grepl("T\\. koningii", treatment_category) ~ gsub("T\\. koningii", "*T. koningii*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

# Create box plot for pH - Experiment 1_2
ph_plot_exp2 <- ggplot(ph_data, aes(x = ph_value, y = treatment_category)) +
  # Add reference line for neutral pH
  geom_vline(xintercept = 7, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  # Box plots with professional colors
  geom_boxplot(fill = "#B2182B", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "B) pH distribution by treatment category (14 DPI) - Experiment 2",
    x = "pH value",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_text(size = 11, face = "bold")
  ) +
  scale_x_continuous(
    limits = c(5, 10), 
    breaks = c(5, 6, 7, 8, 9, 10),
    labels = c("5", "6", "7\n(neutral)", "8", "9", "10")
  ) +
  scale_y_discrete(labels = ph_labels)

# Display the pH plot
print(ph_plot_exp2)
```

## Weight Change Analysis

```{r weight-change-data, include=FALSE}
# Use the specialized filtered datasets for weight change analysis
weight_change_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, weight_percent_change, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    # Convert negative weight change to positive (weight loss as positive decomposition)
    weight_percent_change = abs(weight_percent_change),
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(weight_percent_change))

weight_change_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, weight_percent_change, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    experiment = "Experiment 1_2",
    # Convert negative weight change to positive (weight loss as positive decomposition)
    weight_percent_change = abs(weight_percent_change),
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(weight_percent_change))

# Create factor with categories in desired order based on growth status
# Get individual species with growth and no contamination for weight change data
weight_species_with_growth_1_1 <- unique(weight_change_data$treatment_category[!weight_change_data$treatment_category %in% fixed_categories])
weight_species_with_growth_1_2 <- unique(weight_change_data$treatment_category[!weight_change_data$treatment_category %in% fixed_categories])

# Create category levels including individual species names for growth without contamination
weight_category_levels_1_1 <- c(fixed_categories[fixed_categories %in% unique(weight_change_data$treatment_category)], 
                                sort(weight_species_with_growth_1_1))
weight_category_levels_1_2 <- c(fixed_categories[fixed_categories %in% unique(weight_change_data$treatment_category)], 
                                sort(weight_species_with_growth_1_2))

weight_change_data$treatment_category <- factor(weight_change_data$treatment_category, levels = rev(weight_category_levels_1_1))
weight_change_data$treatment_category <- factor(weight_change_data$treatment_category, levels = rev(weight_category_levels_1_2))

# Calculate sample size information for weight change data by category
weight_sample_info <- weight_change_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )

weight_sample_info <- weight_change_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )
```

```{r weight-change-plots, fig.width=8, fig.height=6}
# Create custom y-axis labels with sample info on second line
# Format species names in italics
weight_labels <- weight_sample_info %>%
  arrange(match(treatment_category, levels(weight_change_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F15", treatment_category) ~ gsub("F15 Faecal isolate 1", "*F15* Faecal isolate 1", treatment_category),
      grepl("F31", treatment_category) ~ gsub("F31 Mucor spp I3", "*F31 Mucor* spp. I3", treatment_category),
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

weight_change_plot_1_1 <- ggplot(weight_change_data, aes(x = weight_percent_change, y = treatment_category)) +
  # Add reference line at 0% change
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  # Box plots with professional colors
  geom_boxplot(fill = "#2166AC", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "A) Weight loss distribution by treatment category (14 DPI) - Experiment 1",
    x = "Weight loss (%)",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_text(size = 11, face = "bold")
  ) +
  scale_x_continuous(limits = c(0, max(weight_change_data$weight_percent_change) * 1.1)) +
  scale_y_discrete(labels = weight_labels)

# Create custom y-axis labels with sample info on second line
# Format species names in italics
weight_labels <- weight_sample_info %>%
  arrange(match(treatment_category, levels(weight_change_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("F40", treatment_category) ~ gsub("F40", "*F40*", treatment_category),
      grepl("G\\. lucidum", treatment_category) ~ gsub("G\\. lucidum", "*G. lucidum*", treatment_category),
      grepl("P\\. ostreatus columbinus", treatment_category) ~ gsub("P\\. ostreatus columbinus", "*P. ostreatus* columbinus", treatment_category),
      grepl("P\\. ostreatus", treatment_category) & !grepl("columbinus", treatment_category) ~ gsub("P\\. ostreatus", "*P. ostreatus*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      grepl("T\\. koningii", treatment_category) ~ gsub("T\\. koningii", "*T. koningii*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

# Create box plot for weight change - Experiment 1_2
weight_change_plot_exp2 <- ggplot(weight_change_data, aes(x = weight_percent_change, y = treatment_category)) +
  # Add reference line at 0% change
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  # Box plots with professional colors
  geom_boxplot(fill = "#B2182B", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "B) Weight loss distribution by treatment category (14 DPI) - Experiment 2",
    x = "Weight loss (%)",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_text(size = 11, face = "bold")
  ) +
  scale_x_continuous(limits = c(0, max(weight_change_data$weight_percent_change) * 1.1)) +
  scale_y_discrete(labels = weight_labels)

# Display the weight change plot
print(weight_change_plot_exp2)
```

## E. coli Concentration Analysis

```{r ecoli-conc-data, include=FALSE}
# Prepare E. coli concentration data for Experiment 1_2 (14 DPI only)
# Using the specialized filtered datasets

ecoli_conc_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, ecoli_conc, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    # Keep actual values including zeros
    ecoli_concentration = ecoli_conc,
    # For plotting on log scale, add 1 to all values (will subtract in axis labels)
    ecoli_concentration_plot = ecoli_conc + 1,
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(ecoli_concentration) & ecoli_concentration >= 0)

ecoli_conc_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, ecoli_conc, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    experiment = "Experiment 1_2",
    # Keep actual values including zeros
    ecoli_concentration = ecoli_conc,
    # For plotting on log scale, add 1 to all values (will subtract in axis labels)
    ecoli_concentration_plot = ecoli_conc + 1,
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(ecoli_concentration) & ecoli_concentration >= 0)

# Create factor with categories in desired order based on growth status
# Get individual species with growth and no contamination for E. coli data
ecoli_species_with_growth_1_1 <- unique(ecoli_conc_data$treatment_category[!ecoli_conc_data$treatment_category %in% fixed_categories])
ecoli_species_with_growth_1_2 <- unique(ecoli_conc_data$treatment_category[!ecoli_conc_data$treatment_category %in% fixed_categories])

# Create category levels including individual species names for growth without contamination
ecoli_category_levels_1_1 <- c(fixed_categories[fixed_categories %in% unique(ecoli_conc_data$treatment_category)], 
                               sort(ecoli_species_with_growth_1_1))
ecoli_category_levels_1_2 <- c(fixed_categories[fixed_categories %in% unique(ecoli_conc_data$treatment_category)], 
                               sort(ecoli_species_with_growth_1_2))

ecoli_conc_data$treatment_category <- factor(ecoli_conc_data$treatment_category, levels = rev(ecoli_category_levels_1_1))
ecoli_conc_data$treatment_category <- factor(ecoli_conc_data$treatment_category, levels = rev(ecoli_category_levels_1_2))

# Calculate sample size information for E. coli concentration data by category
ecoli_conc_sample_info <- ecoli_conc_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )

ecoli_conc_sample_info <- ecoli_conc_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )
```

```{r ecoli-conc-plots, fig.width=8, fig.height=6}
# Create custom y-axis labels with sample info on second line
# Format species names in italics
ecoli_conc_labels <- ecoli_conc_sample_info %>%
  arrange(match(treatment_category, levels(ecoli_conc_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F15", treatment_category) ~ gsub("F15 Faecal isolate 1", "*F15* Faecal isolate 1", treatment_category),
      grepl("F31", treatment_category) ~ gsub("F31 Mucor spp I3", "*F31 Mucor* spp. I3", treatment_category),
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

ecoli_conc_plot_1_1 <- ggplot(ecoli_conc_data, aes(x = ecoli_concentration_plot, y = treatment_category)) +
  # Box plots with professional colors
  geom_boxplot(fill = "#2166AC", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "A) *E. coli* concentration by treatment category (14 DPI) - Experiment 1",
    x = "*E. coli* concentration (CFU/g, log scale)",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_markdown(size = 11, face = "bold"),
    axis.title.x = element_markdown(size = 11, face = "bold")
  ) +
  scale_x_continuous(trans = "log10") +
  scale_y_discrete(labels = ecoli_conc_labels)

# Create custom y-axis labels with sample info on second line
# Format species names in italics
ecoli_conc_labels <- ecoli_conc_sample_info %>%
  arrange(match(treatment_category, levels(ecoli_conc_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("F40", treatment_category) ~ gsub("F40", "*F40*", treatment_category),
      grepl("G\\. lucidum", treatment_category) ~ gsub("G\\. lucidum", "*G. lucidum*", treatment_category),
      grepl("P\\. ostreatus columbinus", treatment_category) ~ gsub("P\\. ostreatus columbinus", "*P. ostreatus* columbinus", treatment_category),
      grepl("P\\. ostreatus", treatment_category) & !grepl("columbinus", treatment_category) ~ gsub("P\\. ostreatus", "*P. ostreatus*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      grepl("T\\. koningii", treatment_category) ~ gsub("T\\. koningii", "*T. koningii*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

# Create box plot for E. coli concentration - Experiment 1_2
ecoli_conc_plot_exp2 <- ggplot(ecoli_conc_data, aes(x = ecoli_concentration_plot, y = treatment_category)) +
  # Box plots with professional colors
  geom_boxplot(fill = "#B2182B", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "B) *E. coli* concentration by treatment category (14 DPI) - Experiment 2",
    x = "*E. coli* concentration (CFU/g, log scale)",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_markdown(size = 11, face = "bold"),
    axis.title.x = element_markdown(size = 11, face = "bold")
  ) +
  scale_x_continuous(trans = "log10") +
  scale_y_discrete(labels = ecoli_conc_labels)

# Display the E. coli concentration plot
print(ecoli_conc_plot_exp2)
```

## E. coli Log Change Analysis

```{r ecoli-log-change-data, include=FALSE}
# Prepare E. coli log change data for Experiment 1_2 (14 DPI only)
# Calculate log change as log10(baseline) - log10(14dpi) where positive values = reduction
# Using the specialized filtered datasets

ecoli_log_change_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, ecoli_conc, ecoli_conc_mean_0dpi, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    # Replace 0 values with 1 for log calculation
    ecoli_conc_adj = case_when(
      ecoli_conc == 0 ~ 1,
      TRUE ~ ecoli_conc
    ),
    ecoli_conc_mean_0dpi_adj = case_when(
      ecoli_conc_mean_0dpi == 0 ~ 1,
      TRUE ~ ecoli_conc_mean_0dpi
    ),
    ecoli_log_change = log10(ecoli_conc_mean_0dpi_adj) - log10(ecoli_conc_adj),
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(ecoli_log_change) & !is.infinite(ecoli_log_change))

ecoli_log_change_data <- experiment_1_2_filtered %>%
  select(id_treatment, species, ecoli_conc, ecoli_conc_mean_0dpi, growth_status_14dpi) %>%
  mutate(
    time_point = "14 DPI",
    experiment = "Experiment 1_2",
    # Replace 0 values with 1 for log calculation
    ecoli_conc_adj = case_when(
      ecoli_conc == 0 ~ 1,
      TRUE ~ ecoli_conc
    ),
    ecoli_conc_mean_0dpi_adj = case_when(
      ecoli_conc_mean_0dpi == 0 ~ 1,
      TRUE ~ ecoli_conc_mean_0dpi
    ),
    ecoli_log_change = log10(ecoli_conc_mean_0dpi_adj) - log10(ecoli_conc_adj),
    # Create treatment category from growth status and species
    treatment_category = case_when(
      species == "ctrl" ~ paste("Control:", growth_status_14dpi),
      growth_status_14dpi == "Growth, no contamination" ~ species,  # Keep species name for growth without contamination
      TRUE ~ growth_status_14dpi
    )
  ) %>%
  filter(!is.na(ecoli_log_change) & !is.infinite(ecoli_log_change))

# Create factor with categories in desired order based on growth status
# Get individual species with growth and no contamination for E. coli log change data
ecoli_log_species_with_growth_1_1 <- unique(ecoli_log_change_data$treatment_category[!ecoli_log_change_data$treatment_category %in% fixed_categories])
ecoli_log_species_with_growth_1_2 <- unique(ecoli_log_change_data$treatment_category[!ecoli_log_change_data$treatment_category %in% fixed_categories])

# Create category levels including individual species names for growth without contamination
ecoli_log_category_levels_1_1 <- c(fixed_categories[fixed_categories %in% unique(ecoli_log_change_data$treatment_category)], 
                                   sort(ecoli_log_species_with_growth_1_1))
ecoli_log_category_levels_1_2 <- c(fixed_categories[fixed_categories %in% unique(ecoli_log_change_data$treatment_category)], 
                                   sort(ecoli_log_species_with_growth_1_2))

ecoli_log_change_data$treatment_category <- factor(ecoli_log_change_data$treatment_category, levels = rev(ecoli_log_category_levels_1_1))
ecoli_log_change_data$treatment_category <- factor(ecoli_log_change_data$treatment_category, levels = rev(ecoli_log_category_levels_1_2))

# Calculate sample size information for E. coli log change data by category
ecoli_log_change_sample_info <- ecoli_log_change_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )

ecoli_log_change_sample_info <- ecoli_log_change_data %>%
  group_by(treatment_category) %>%
  summarise(
    n_observations = n(),
    n_faecal_samples = n_distinct(case_when(
      !is.na(id_treatment) ~ experiment_1_2$id_faeces[match(id_treatment, experiment_1_2$id_treatment)]
    ), na.rm = TRUE),
    n_species = n_distinct(species),
    .groups = "drop"
  ) %>%
  mutate(
    sample_label = paste0("n=", n_observations, ", f=", n_faecal_samples, ", s=", n_species)
  )
```

```{r ecoli-log-change-plots, fig.width=8, fig.height=6}
# Create custom y-axis labels with sample info on second line
# Format species names in italics
ecoli_log_change_labels <- ecoli_log_change_sample_info %>%
  arrange(match(treatment_category, levels(ecoli_log_change_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F15", treatment_category) ~ gsub("F15 Faecal isolate 1", "*F15* Faecal isolate 1", treatment_category),
      grepl("F31", treatment_category) ~ gsub("F31 Mucor spp I3", "*F31 Mucor* spp. I3", treatment_category),
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

ecoli_log_change_plot_1_1 <- ggplot(ecoli_log_change_data, aes(x = ecoli_log_change, y = treatment_category)) +
  # Add reference line at 0 (no change)
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  # Box plots with professional colors
  geom_boxplot(fill = "#2166AC", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "A) *E. coli* log reduction by treatment category (14 DPI) - Experiment 1",
    x = "*E. coli* log reduction (log₁₀ CFU/g)",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_markdown(size = 11, face = "bold"),
    axis.title.x = element_markdown(size = 11, face = "bold")
  ) +
  scale_y_discrete(labels = ecoli_log_change_labels)

# Create custom y-axis labels with sample info on second line
# Format species names in italics
ecoli_log_change_labels <- ecoli_log_change_sample_info %>%
  arrange(match(treatment_category, levels(ecoli_log_change_data$treatment_category))) %>%
  mutate(
    # Format treatment category with italics for species names
    formatted_category = case_when(
      grepl("F35", treatment_category) ~ gsub("F35 Sordaria", "*F35 Sordaria*", treatment_category),
      grepl("F40", treatment_category) ~ gsub("F40", "*F40*", treatment_category),
      grepl("G\\. lucidum", treatment_category) ~ gsub("G\\. lucidum", "*G. lucidum*", treatment_category),
      grepl("P\\. ostreatus columbinus", treatment_category) ~ gsub("P\\. ostreatus columbinus", "*P. ostreatus* columbinus", treatment_category),
      grepl("P\\. ostreatus", treatment_category) & !grepl("columbinus", treatment_category) ~ gsub("P\\. ostreatus", "*P. ostreatus*", treatment_category),
      grepl("T\\. harzianum", treatment_category) ~ gsub("T\\. harzianum", "*T. harzianum*", treatment_category),
      grepl("T\\. koningii", treatment_category) ~ gsub("T\\. koningii", "*T. koningii*", treatment_category),
      TRUE ~ treatment_category
    ),
    custom_label = paste0(formatted_category, "\n(n=", n_observations, ", f=", n_faecal_samples, ")")
  ) %>%
  pull(custom_label)

# Create box plot for E. coli log change - Experiment 1_2
ecoli_log_change_plot_exp2 <- ggplot(ecoli_log_change_data, aes(x = ecoli_log_change, y = treatment_category)) +
  # Add reference line at 0 (no change)
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", size = 0.5, alpha = 0.5) +
  # Box plots with professional colors
  geom_boxplot(fill = "#B2182B", alpha = 0.7, color = "black", size = 0.5, outlier.shape = NA) +
  # Individual points
  geom_point(alpha = 0.6, size = 1.5, color = "black", position = position_jitter(height = 0.2)) +
  # Labels
  labs(
    title = "B) *E. coli* log reduction by treatment category (14 DPI) - Experiment 2",
    x = "*E. coli* log reduction (log₁₀ CFU/g)",
    y = NULL
  ) +
  # Apply publication theme
  theme_publication() +
  theme(
    axis.text.y = element_markdown(size = 8, lineheight = 0.9),
    plot.title = element_markdown(size = 11, face = "bold"),
    axis.title.x = element_markdown(size = 11, face = "bold")
  ) +
  scale_y_discrete(labels = ecoli_log_change_labels)

# Display the E. coli log change plot
print(ecoli_log_change_plot_exp2)
```

# Faecal Sample Characteristics and Growth Success

## Relationship Between Initial Faecal Parameters and Growth Success: P. ostreatus vs G. lucidum

This section examines whether the characteristics of the initial faecal sample influence the probability of successful growth for two contrasting fungal species: **P. ostreatus columbinus** (aggressive decomposer) and **G. lucidum** (slow-growing medicinal mushroom).

```{r faecal-growth-correlation-setup, include=FALSE}
# Create binary growth outcome variable and combine with initial faecal parameters
# Using area_size_14dpi > 10 mm² as meaningful growth threshold
# ONLY ANALYZING EXPERIMENT 1_2
growth_faecal_data <- experiment_1_2 %>%
  mutate(
    # Binary growth outcome: meaningful growth based on area size
    growth_success_binary = case_when(
      is.na(area_size_14dpi) ~ 0,  # No growth if area not measured
      area_size_14dpi > 10 ~ 1,    # Growth if area > 10 mm²
      area_size_14dpi <= 10 ~ 0    # No meaningful growth if area ≤ 10 mm²
    ),
    growth_success_binary = as.factor(growth_success_binary)
  ) %>%
  # Join with initial faecal parameters
  select(id_treatment, id_faeces, species, growth_success_binary, 
         area_size_14dpi, growth_description_14dpi, ph_0dpi, water_content_0dpi, ecoli_conc_mean_0dpi) %>%
  filter(!is.na(growth_success_binary), 
         species %in% c("P. ostreatus columbinus", "G. lucidum")) %>%  # Only analyze these two species
  mutate(
    # Log transform E. coli for analysis
    log_ecoli_0dpi = log10(ecoli_conc_mean_0dpi + 1)  # +1 to handle zeros
  )

# Calculate summary statistics by growth outcome
faecal_summary_stats <- growth_faecal_data %>%
  group_by(growth_success_binary) %>%
  summarise(
    n = n(),
    mean_ph = round(mean(ph_0dpi, na.rm = TRUE), 2),
    sd_ph = round(sd(ph_0dpi, na.rm = TRUE), 2),
    mean_water = round(mean(water_content_0dpi, na.rm = TRUE), 1),
    sd_water = round(sd(water_content_0dpi, na.rm = TRUE), 1),
    mean_ecoli = round(mean(ecoli_conc_mean_0dpi, na.rm = TRUE), 0),
    median_ecoli = round(median(ecoli_conc_mean_0dpi, na.rm = TRUE), 0),
    mean_log_ecoli = round(mean(log_ecoli_0dpi, na.rm = TRUE), 2),
    sd_log_ecoli = round(sd(log_ecoli_0dpi, na.rm = TRUE), 2),
    .groups = "drop"
  )
```

### Visualization of Relationships

```{r faecal-growth-plots, fig.height=12, fig.width=10}
# Create species-specific color palette
species_colors <- c("P. ostreatus columbinus" = "#2166AC", "G. lucidum" = "#B2182B")

# pH plot with species comparison
ph_plot <- ggplot(growth_faecal_data, aes(x = growth_success_binary, y = ph_0dpi, fill = species)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  geom_point(aes(color = species), alpha = 0.6, size = 1.5, 
             position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8)) +
  labs(
    title = "A) Initial pH vs Growth Success by Species",
    subtitle = "P. ostreatus vs G. lucidum comparison",
    x = "Growth Outcome",
    y = "pH at 0 DPI",
    fill = "Species",
    color = "Species"
  ) +
  theme_publication() +
  scale_fill_manual(values = species_colors) +
  scale_color_manual(values = species_colors) +
  scale_x_discrete(labels = c("0" = "No Growth\n(≤10 mm²)", "1" = "Growth\n(>10 mm²)"))

# Water content plot with species comparison
water_plot <- ggplot(growth_faecal_data, aes(x = growth_success_binary, y = water_content_0dpi, fill = species)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  geom_point(aes(color = species), alpha = 0.6, size = 1.5,
             position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8)) +
  labs(
    title = "B) Initial Water Content vs Growth Success by Species",
    subtitle = "P. ostreatus vs G. lucidum comparison",
    x = "Growth Outcome",
    y = "Water Content at 0 DPI (%)",
    fill = "Species",
    color = "Species"
  ) +
  theme_publication() +
  scale_fill_manual(values = species_colors) +
  scale_color_manual(values = species_colors) +
  scale_x_discrete(labels = c("0" = "No Growth\n(≤10 mm²)", "1" = "Growth\n(>10 mm²)"))

# E. coli plot with species comparison
ecoli_plot <- ggplot(growth_faecal_data, aes(x = growth_success_binary, y = log_ecoli_0dpi, fill = species)) +
  geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
  geom_point(aes(color = species), alpha = 0.6, size = 1.5,
             position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8)) +
  labs(
    title = "C) Initial E. coli Concentration vs Growth Success by Species",
    subtitle = "P. ostreatus vs G. lucidum comparison",
    x = "Growth Outcome",
    y = "Log10(E. coli CFU/g + 1)",
    fill = "Species",
    color = "Species"
  ) +
  theme_publication() +
  scale_fill_manual(values = species_colors) +
  scale_color_manual(values = species_colors) +
  scale_x_discrete(labels = c("0" = "No Growth\n(≤10 mm²)", "1" = "Growth\n(>10 mm²)"))

# Combine plots
library(gridExtra)
grid.arrange(ph_plot, water_plot, ecoli_plot, ncol = 1)
```

### Interpretation

```{r interpretation}
cat("### Key Findings:\n\n")

# Determine significant relationships
significant_vars <- c()
for(i in 1:length(variables)) {
  result <- calc_point_biserial(growth_faecal_data, variables[i])
  if(!is.na(result$p_value) && result$p_value < 0.05) {
    significant_vars <- c(significant_vars, var_names[i])
  }
}

if(length(significant_vars) > 0) {
  cat("**Significant relationships found between growth success and:**\n")
  for(var in significant_vars) {
    cat(sprintf("- %s\n", var))
  }
} else {
  cat("**No statistically significant relationships found** between initial faecal sample characteristics and growth success at the p < 0.05 level.\n")
}

cat("\n**Species-specific insights:**\n")

# Compare growth rates between species
p_growth_rate <- if(nrow(p_ostreatus_data) > 0) {
  round(sum(p_ostreatus_data$growth_success_binary == "1") / nrow(p_ostreatus_data) * 100, 1)
} else { NA }

g_growth_rate <- if(nrow(g_lucidum_data) > 0) {
  round(sum(g_lucidum_data$growth_success_binary == "1") / nrow(g_lucidum_data) * 100, 1)
} else { NA }

if(!is.na(p_growth_rate) && !is.na(g_growth_rate)) {
  cat(sprintf("- **P. ostreatus**: %.1f%% growth success rate (n=%d)\n", p_growth_rate, nrow(p_ostreatus_data)))
  cat(sprintf("- **G. lucidum**: %.1f%% growth success rate (n=%d)\n", g_growth_rate, nrow(g_lucidum_data)))
  
  if(p_growth_rate > g_growth_rate) {
    cat("- P. ostreatus shows higher adaptability to faecal substrate conditions\n")
  } else if(g_growth_rate > p_growth_rate) {
    cat("- G. lucidum unexpectedly outperforms P. ostreatus on faecal substrate\n")
  } else {
    cat("- Both species show similar growth success rates\n")
  }
}

cat("\n**Practical implications:**\n")
cat("- Species selection should consider substrate characteristics and treatment goals\n")
cat("- P. ostreatus: Fast decomposer, suitable for rapid waste processing\n")
cat("- G. lucidum: Slow grower, may offer unique biochemical transformations\n")
cat("- Environmental parameter optimization may be species-specific\n")
```

------------------------------------------------------------------------

**Note:** This analysis focuses exclusively on Experiment 1_2 data, which provides the most complete dataset for comprehensive analysis of fungal treatment effects on faecal material. Results are specific to the experimental conditions and species tested in this particular experiment.
