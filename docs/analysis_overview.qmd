---
title: "Fungal Treatment Analysis Overview"
format: 
  html:
    toc: false
    number-sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, 
                      fig.width = 12, fig.height = 8, dpi = 300)

library(tidyverse)
library(here)
library(ggplot2)
library(scales)
library(knitr)
library(patchwork)

# Load data
exp_data <- read_csv(here("data/processed/experiment_final.csv"), show_col_types = FALSE) %>%
  mutate(
    species = ifelse(species == "ctrl", "Control", species),
    MAX_PLATE_AREA = 63.62
  )

# Remove F37 Mold and F39 Thermo tolerant from analysis
exp_data <- exp_data %>%
  filter(species != "F37 Mold", species != "F39 Thermo tolerant")

# Remove data points marked with "exclude" during data cleaning
exp_data <- exp_data %>%
  filter(is.na(exclude) | exclude != "exclude")

# Create consistent species ordering with Control first
species_order <- exp_data %>%
  distinct(species) %>%
  arrange(species != "Control", species) %>%
  pull(species)

exp_data <- exp_data %>%
  mutate(species = factor(species, levels = species_order))
```

# Sample Size Summary

## Experiment 1_1 Replicates

```{r exp1-replicates}
exp1_summary <- exp_data %>%
  filter(experiment == "1_1") %>%
  group_by(species) %>%
  summarise(
    technical_replicates = n(),
    biological_replicates = n_distinct(paste(id_faeces, starting_date)),
    growth_data = sum(!is.na(area_size_14dpi)),
    ecoli_data = sum(!is.na(ecoli_conc_14dpi)),
    weight_data = sum(!is.na(weight_14dpi)),
    .groups = "drop"
  ) %>%
  arrange(desc(technical_replicates))

kable(exp1_summary,
      caption = "**Experiment 1_1: Sample sizes and data availability**",
      col.names = c("Species", "Technical Reps", "Biological Reps", "Growth Data", "E.coli Data", "Weight Data"))
```

## Experiment 1_2 Replicates

```{r exp2-replicates}
exp2_summary <- exp_data %>%
  filter(experiment == "1_2") %>%
  group_by(species) %>%
  summarise(
    technical_replicates = n(),
    biological_replicates = n_distinct(paste(id_faeces, starting_date)),
    growth_data = sum(!is.na(area_size_14dpi)),
    ecoli_data = sum(!is.na(ecoli_conc_14dpi)),
    weight_data = sum(!is.na(weight_14dpi)),
    .groups = "drop"
  ) %>%
  arrange(desc(technical_replicates))

kable(exp2_summary,
      caption = "**Experiment 1_2: Sample sizes and data availability**",
      col.names = c("Species", "Technical Reps", "Biological Reps", "Growth Data", "E.coli Data", "Weight Data"))
```

# Growth Analysis

## Experiment 1_1 Growth

```{r growth-exp1, fig.height=8}
# Growth data for Experiment 1_1 - raw data for boxplots
growth_exp1_raw <- exp_data %>%
  filter(experiment == "1_1") %>%
  select(species, area_size_7dpi, area_size_14dpi) %>%
  pivot_longer(cols = c(area_size_7dpi, area_size_14dpi),
               names_to = "timepoint",
               values_to = "area_cm2") %>%
  filter(!is.na(area_cm2), is.finite(area_cm2)) %>%
  mutate(
    day = case_when(
      timepoint == "area_size_7dpi" ~ "7 DPI",
      timepoint == "area_size_14dpi" ~ "14 DPI"
    ),
    species = factor(species, levels = species_order)
  )

if(nrow(growth_exp1_raw) > 0) {
  # Add separation lines between species
  n_species <- length(levels(growth_exp1_raw$species))
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(growth_exp1_raw, aes(x = area_cm2, y = species, fill = day)) +
    geom_hline(yintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
    geom_vline(xintercept = 63.62, linetype = "dashed", color = "red", alpha = 0.7) +
    labs(title = "Experiment 1_1: Fungal Growth at 7 and 14 DPI",
         x = "Colony Area (cm²)",
         y = "Species",
         fill = "Timepoint") +
    theme_minimal(base_size = 12) +
    theme(legend.position = "bottom",
          panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No growth data available for Experiment 1_1", cex = 1.2)
}
```

## Experiment 1_2 Growth

```{r growth-exp2, fig.height=8}
# Growth data for Experiment 1_2 - raw data for boxplots
growth_exp2_raw <- exp_data %>%
  filter(experiment == "1_2") %>%
  select(species, area_size_7dpi, area_size_14dpi) %>%
  pivot_longer(cols = c(area_size_7dpi, area_size_14dpi),
               names_to = "timepoint",
               values_to = "area_cm2") %>%
  filter(!is.na(area_cm2), is.finite(area_cm2)) %>%
  mutate(
    day = case_when(
      timepoint == "area_size_7dpi" ~ "7 DPI",
      timepoint == "area_size_14dpi" ~ "14 DPI"
    ),
    species = factor(species, levels = species_order)
  )

if(nrow(growth_exp2_raw) > 0) {
  # Add separation lines between species
  n_species <- length(levels(growth_exp2_raw$species))
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(growth_exp2_raw, aes(x = area_cm2, y = species, fill = day)) +
    geom_hline(yintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, position = position_dodge(width = 0.8)) +
    geom_vline(xintercept = 63.62, linetype = "dashed", color = "red", alpha = 0.7) +
    labs(title = "Experiment 1_2: Fungal Growth at 7 and 14 DPI",
         x = "Colony Area (cm²)",
         y = "Species",
         fill = "Timepoint") +
    theme_minimal(base_size = 12) +
    theme(legend.position = "bottom",
          panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No growth data available for Experiment 1_2", cex = 1.2)
}
```

Several fungi grow reliably on fresh human faeces. The fastest growing species on pure as well as on 2:1 wood chip mixed faeces are the Sordaria isolates. The fungal mycelium degrades in unmixed samples after around 7 days the mycelium is still visible at day 14 in the mixed samples and only becomes weaker less dense.Formation of conidida (Mucor, Trichoderma) and fruiting bodies (perithecia, Sordaria) are only visible in mixed samples.

On Basidiomycetes (isolate F40, coprinopsis?) showed very strong mycelium growth in one assay, while failed completely in the first one. Adding more accesible cellulose and using stronger inoculum could help improving reliability of the mycelium growth.

# pH Changes

## Experiment 1_1 pH Changes

```{r ph-exp1, fig.height=6}
ph_exp1 <- exp_data %>%
  filter(experiment == "1_1", !is.na(ph_0dpi), !is.na(ph_14dpi)) %>%
  mutate(ph_change = ph_14dpi - ph_0dpi)

if(nrow(ph_exp1) > 0) {
  # Add separation lines between species
  n_species <- length(species_order)
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(ph_exp1, aes(x = factor(species, levels = rev(species_order)), y = ph_change)) +
    geom_vline(xintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, fill = "lightblue") +
    geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
    coord_flip() +
    labs(title = "Experiment 1_1: pH Changes from 0 to 14 DPI",
         x = "Species",
         y = "pH Change (14 DPI - 0 DPI)") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No pH data available for Experiment 1_1", cex = 1.2)
}
```

## Experiment 1_2 pH Changes

```{r ph-exp2, fig.height=6}
ph_exp2 <- exp_data %>%
  filter(experiment == "1_2", !is.na(ph_0dpi), !is.na(ph_14dpi)) %>%
  mutate(ph_change = ph_14dpi - ph_0dpi)

if(nrow(ph_exp2) > 0) {
  # Add separation lines between species
  n_species <- length(species_order)
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(ph_exp2, aes(x = factor(species, levels = rev(species_order)), y = ph_change)) +
    geom_vline(xintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, fill = "lightcoral") +
    geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
    coord_flip() +
    labs(title = "Experiment 1_2: pH Changes from 0 to 14 DPI",
         x = "Species",
         y = "pH Change (14 DPI - 0 DPI)") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No pH data available for Experiment 1_2", cex = 1.2)
}
```

-   In pure and mixed samples the pH of all plates that showed fungal growth increased to around 9
-   Plates without fungal growth the pH was lower around 5.5

This change of pH is due to ammonia production, ammonia is produced due to bacterial metabolism of amino acids to gain energy. The problem is that fungal enzymes might not work at this pH and the degradation is slowed down.

Fungi are known to produce acids and during degradation and prefer an environment slightly acidic around 5.5

Follow up question Can the pH be kept in the optimal range by replacing the hard degradable wood chips with easier degradable material flax fibers and flax fibers mixed with cellulose powder.

# E. coli Reduction

## Experiment 1_1 E. coli Reduction

```{r ecoli-exp1, fig.height=6}
ecoli_exp1 <- exp_data %>%
  filter(experiment == "1_1", !is.na(ecoli_conc_mean), !is.na(ecoli_conc_14dpi),
         ecoli_conc_mean > 0, ecoli_conc_14dpi > 0) %>%
  mutate(ecoli_log_reduction = log10(ecoli_conc_mean) - log10(ecoli_conc_14dpi))

if(nrow(ecoli_exp1) > 0) {
  # Add separation lines between species
  n_species <- length(species_order)
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(ecoli_exp1, aes(x = factor(species, levels = rev(species_order)), y = ecoli_log_reduction)) +
    geom_vline(xintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, fill = "lightgreen") +
    geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
    coord_flip() +
    labs(title = "Experiment 1_1: E. coli Log Reduction",
         x = "Species",
         y = "Log Reduction (Log10 Initial - Log10 Final)") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No E. coli data available for Experiment 1_1", cex = 1.2)
}
```

## Experiment 1_2 E. coli Reduction

```{r ecoli-exp2, fig.height=6}
ecoli_exp2 <- exp_data %>%
  filter(experiment == "1_2", !is.na(ecoli_conc_mean), !is.na(ecoli_conc_14dpi),
         ecoli_conc_mean > 0, ecoli_conc_14dpi > 0) %>%
  mutate(ecoli_log_reduction = log10(ecoli_conc_mean) - log10(ecoli_conc_14dpi))

if(nrow(ecoli_exp2) > 0) {
  # Add separation lines between species
  n_species <- length(species_order)
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(ecoli_exp2, aes(x = factor(species, levels = rev(species_order)), y = ecoli_log_reduction)) +
    geom_vline(xintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, fill = "lightpink") +
    geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
    coord_flip() +
    labs(title = "Experiment 1_2: E. coli Log Reduction",
         x = "Species",
         y = "Log Reduction (Log10 Initial - Log10 Final)") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No E. coli data available for Experiment 1_2", cex = 1.2)
}
```

In pure and mixed faeceal samples the fungla growth led to increased E. coli numbers compared to plates without fungal growth. This increase in bacterial concentrations is probably caused by the fungi that makes nutrients (Proteins, lipids and lignocellulose materials) easier available for the bacteria due to enzymatic activity. This speeding up of the degradation process leads to a boost in microbila activity of bacteria present. Due to degradation of amino acids after usage of carbon the pH rises.

The presence of fungi seems to increase bacterial rich ness in generla compared to non-fungal growth samples

# Weight Changes

## Experiment 1_1 Weight Changes

### Wet Weight Changes

```{r wet-weight-exp1, fig.height=6}
wet_weight_exp1 <- exp_data %>%
  filter(experiment == "1_1", !is.na(weight_0dpi), !is.na(weight_14dpi)) %>%
  mutate(wet_weight_percent_change = ((weight_14dpi - weight_0dpi) / weight_0dpi) * 100)

if(nrow(wet_weight_exp1) > 0) {
  # Add separation lines between species
  n_species <- length(species_order)
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(wet_weight_exp1, aes(x = factor(species, levels = rev(species_order)), y = wet_weight_percent_change)) +
    geom_vline(xintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, fill = "lightsteelblue") +
    geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
    coord_flip() +
    labs(title = "Experiment 1_1: Wet Weight Changes",
         x = "Species",
         y = "Wet Weight Change (%)") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No wet weight data available for Experiment 1_1", cex = 1.2)
}
```

## Experiment 1_2 Weight Changes

### Wet Weight Changes

```{r wet-weight-exp2, fig.height=6}
wet_weight_exp2 <- exp_data %>%
  filter(experiment == "1_2", !is.na(weight_0dpi), !is.na(weight_14dpi)) %>%
  mutate(wet_weight_percent_change = ((weight_14dpi - weight_0dpi) / weight_0dpi) * 100)

if(nrow(wet_weight_exp2) > 0) {
  # Add separation lines between species
  n_species <- length(species_order)
  separation_lines <- seq(1.5, n_species - 0.5, by = 1)
  
  ggplot(wet_weight_exp2, aes(x = factor(species, levels = rev(species_order)), y = wet_weight_percent_change)) +
    geom_vline(xintercept = separation_lines, color = "gray80", linetype = "solid", size = 0.5) +
    geom_boxplot(alpha = 0.7, fill = "lightsalmon") +
    geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
    coord_flip() +
    labs(title = "Experiment 1_2: Wet Weight Changes",
         x = "Species",
         y = "Wet Weight Change (%)") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
} else {
  plot.new()
  text(0.5, 0.5, "No wet weight data available for Experiment 1_2", cex = 1.2)
}
```

Overall samples with fungal growth showed reduced wet weights after 14 days of incubation at 25°C 80% humidity. This weight loss is probably due to the fungal enzymes enabling faster break down and making more nutrients easily available for bacteria and the fungi.

What has been achived so far

-   Identified some isolates and strains that did show reliably growth on pure faecal material and some that showed reliable growth on mixed faecal material.

-   Reached faster material degradation progressing faster into the alkaline phase of organic material degradation

-   Fungi increase bacterial concentrations and acitvity

Lessons learned

-   All tested fungi in this setting will lead to the same results at some point carbon becomes rare and growth will stop. degradation of aminoacids will produce ammonia that increases pH to levels that slow down degradation of the fungus because the enzymes denature and are not active anymore. This means also the ligno cellulose degradation will stop or slow down dramatically.

-   The 2:1 wood cips samples have a balanced out C:N ratio but the carbon is locked away in the wood and degradation is to slow to stop the increase of the pH value. Carbon needs to be easily accesible for the fungus to make it thrive, presence of carbon alone is not enough.

-   To keep the fungi and their enzyme active longer "easy" accessible carbon is needed in the bio mass. More of the proteins could then be bound in to fungal biomass instrewad of being degraded by bacteria to ammonia. This could lead to higher production of konidia ( in-case of Trichoderma), become easily degradable biomass for a further composting step or being dried and used as fertilizer.

What are the next goals

-   Trying to create a medium that stays in acidic conditions longer, to keep fungi dominant over bacteria degradation to turn more of the sample into fungal biomass and keep degradation rate high until it is significantly degraded and the pH does not increase but stays in a more neutral range.

    How will it be tested

    -   Wood chips used are resistant to degradation due to the high lignin content and the high material denisity

    -   More easily degradable carbon sources could help keeping the fungus longer active and producing acids that keep the environment acidic for longer

    -   Materials:

        -   Flax straw lower in lignin, pre-treated due to gaining of flax fibres for fabric industry

        -   Cellulose powder no lignin just simple very available form of cellulose, to dense for usage alone would not provide enough aeration

    -   Fungal strains used

        -   Sordaria one species

        -   Trichoderma koningii

The trial will contain wood chips mixed faeces, flax straw mixed faeces and flax straw and cellulose powder mixed faeces

each treatment will be run in triplicates using 15 grams of faeces in each sampled every 7 days and checked for pH and bacterial concentrations

measure procentual weight loss after each week weight before sampling and after sampling

Expected results are pH is kept lower in both flax straw and flax straw mixed with cellulose powder treatments. Cellulose powder will even stay longer acidic compared to flax straw alone.

Higher weight loss due to degradation of faecal material and faster degradation of the additives

bacterial concentrations might stay more acitve longer due to balanced pH values, acidic conditions might eliminate e coli like in untreated samples.

Goal develop an assay that the fungus can keep the pH down for more than three weeks.
